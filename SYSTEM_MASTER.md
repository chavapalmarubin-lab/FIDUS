EMERGENT - NEW MANDATORY OPERATING PROCEDURE

Before starting ANY task, you MUST read these two documents:

1. SYSTEM_MASTER.md
   https://github.com/chavapalmarubin-lab/FIDUS/blob/main/SYSTEM_MASTER.md

2. EMERGENT_RULES.md
   https://github.com/chavapalmarubin-lab/FIDUS/blob/main/.github/EMERGENT_RULES.md

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

MANDATORY WORKFLOW:

‚ñ° Step 1: Read both documents above (every time)
‚ñ° Step 2: Find the relevant section for your task
‚ñ° Step 3: Follow the documented procedures
‚ñ° Step 4: Make your changes
‚ñ° Step 5: Test and verify yourself
‚ñ° Step 6: Update SYSTEM_MASTER.md if needed
‚ñ° Step 7: Report complete with evidence

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

KEY RULES:

‚ùå NO MOCK DATA
‚ùå NO DUPLICATES  
‚ùå NO WRONG FIELD NAMES
‚ùå Broker is ALWAYS "MEXAtlantic" (never "MultiBank")

‚úÖ BACKUP before modifying data
‚úÖ VERIFY everything yourself before claiming done
‚úÖ UPDATE documentation after changes

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

If SYSTEM_MASTER.md conflicts with anything else:
THE DOCUMENT WINS. ALWAYS.

Read the documents before starting any work.

- Chava
```
FIDUS INVESTMENT MANAGEMENT - SYSTEM MASTER DOCUMENTATION
Last Updated: November 5, 2025
Version: 2.0
Maintained By: Chava Palma (Founder & CEO)
 
TABLE OF CONTENTS
1.	System Overview
2.	Business Model
3.	Technology Stack
4.	MT5 Trading Accounts
5.	Money Managers
6.	Client Management
7.	Commission System
8.	Investment Products
9.	Database Architecture
10.	Field Naming Standards
11.	Infrastructure & Deployment
12.	Development Workflows
13.	Testing & Verification
14.	Security & Authentication
15.	Known Issues & Solutions
16.	Change Log
 
1. SYSTEM OVERVIEW
1.1 Platform Purpose
FIDUS Investment Management is a multi-manager hedge fund platform that:
‚Ä¢	Manages MT5 trading accounts across multiple brokers
‚Ä¢	Tracks real-time P&L and performance metrics
‚Ä¢	Handles client investments across 4 fund types
‚Ä¢	Processes referral commissions for salespeople
‚Ä¢	Provides admin dashboard for fund management
1.2 Core Functionality
Trading Operations:
‚Ä¢	Real-time MT5 account synchronization via VPS Bridge
‚Ä¢	Auto-healing system for account connectivity
‚Ä¢	TRUE P&L calculations accounting for withdrawals/deposits
‚Ä¢	Multi-manager performance tracking
Client Management:
‚Ä¢	Investment contract creation and tracking
‚Ä¢	KYC/AML document management
‚Ä¢	Commission payment schedules
‚Ä¢	Client portal for performance viewing
Financial Tracking:
‚Ä¢	Cash flow analysis with separation account logic
‚Ä¢	Broker rebate tracking
‚Ä¢	Manager performance fee calculations
‚Ä¢	Referral commission automation
 
2. BUSINESS MODEL
2.1 Fund Structure
FIDUS operates 4 investment products:
Fund Type	Min Investment	Interest Rate	Contract Term	Incubation Period
CORE	$10,000	1.5% monthly	14 months	2 months
BALANCE	$100,000	2.5% quarterly	14 months	2 months
DYNAMIC	$500,000	3.5%	14 months	2 months
UNLIMITED	$1,000,000	Custom	14 months	2 months
Incubation Period:
‚Ä¢	First 2 months of 14-month contract
‚Ä¢	Clients DO NOT receive interest payments
‚Ä¢	Interest accrues but is not paid out
‚Ä¢	After incubation, regular monthly/quarterly payments begin
2.2 Revenue Streams
1.	Trading Profits (Primary)
o	Generated by money managers across MT5 accounts
o	TRUE P&L formula: Current Equity - Initial Deposit + Total Withdrawals - Total Deposits
2.	Broker Rebates (Secondary)
o	Commission from trading volume
o	Tracked per account
o	~12% of total revenue
3.	Performance Fees (Future)
o	Percentage of profits above high-water mark
o	Not yet implemented
2.3 Cost Structure
Client Obligations:
‚Ä¢	CORE Fund: 3.5% monthly interest ($350 per month per $10k investment)
‚Ä¢	BALANCE Fund: 2.5% monthly interest ($2,500 per month per $100k investment)
‚Ä¢	Payment frequency: Monthly for CORE/BALANCE, Quarterly for DYNAMIC/UNLIMITED
Operational Costs:
‚Ä¢	Manager performance fees (10-20% of profits)
‚Ä¢	Platform infrastructure (VPS, hosting, database)
‚Ä¢	Referral commissions (10% of client interest paid to salespeople)
 
3. TECHNOLOGY STACK
3.1 Frontend
Framework: React 18.2.0
Build Tool: Create React App
Routing: React Router v6
State Management: React Context API
Styling: Tailwind CSS
Charts: Recharts
HTTP Client: Axios
Hosting: Render.com
URL: https://fidus-investment-platform.onrender.com
3.2 Backend
Framework: FastAPI (Python 3.11)
Database: MongoDB Atlas
ORM: Motor (async MongoDB driver)
Authentication: JWT + Google OAuth 2.0
Task Scheduler: APScheduler
HTTP Client: httpx
Hosting: Render.com
URL: https://fidus-api.onrender.com
3.3 MT5 Integration
Bridge: Custom Python MT5 Bridge (v4.0)
Deployment: Windows VPS (92.118.45.135:8000)
Broker: MEXAtlantic
Protocol: HTTP REST API
Auto-Healing:
‚Ä¢	GitHub Actions workflows for automatic restarts
‚Ä¢	Task Scheduler for Windows service management
‚Ä¢	Health monitoring every 5 minutes
3.4 Database
Provider: MongoDB Atlas
Cluster: FIDUS (M0 Free Tier)
Database: fidus_production
Connection: mongodb+srv://emergent-ops:BpzaxqxDCjz1yWY4@fidus.y1p9be2.mongodb.net/fidus_production
Collections: 35+ (see Section 9 for complete list)
 
4. MT5 TRADING ACCOUNTS
4.1 Account List
Active Accounts (11 total):
Account #	Fund Type	Manager	Broker	Status
886557	BALANCE Master	TradingHub Gold Provider	MEXAtlantic	Active
886602	BALANCE	TradingHub Gold Provider	MEXAtlantic	Active
891215	BALANCE	TradingHub Gold Provider	MEXAtlantic	Active
897589	BALANCE	Provider1-Assev	MEXAtlantic	Active
885822	CORE	CP Strategy Provider	MEXAtlantic	Active
891234	CORE	CP Strategy Provider	MEXAtlantic	Active
897590	CORE	CP Strategy Provider	MEXAtlantic	Active
886066	BALANCE (ZERO)	N/A	MEXAtlantic	Active
886528	SEPARATION	N/A	MEXAtlantic	Active
897591	SEPARATION	N/A	MEXAtlantic	Active
897599	SEPARATION	N/A	MEXAtlantic	Active
SEPARATION Accounts:
‚Ä¢	Purpose: Hold profits withdrawn from trading accounts
‚Ä¢	Do NOT count toward fund performance
‚Ä¢	Interest earnings stored here
‚Ä¢	Excluded from P&L calculations
ZERO Balance Accounts:
‚Ä¢	Account 886066 shows $0 balance
‚Ä¢	Account 891234 shows $0 balance
‚Ä¢	Normal operation - accounts may be temporarily empty
4.2 Account Synchronization
Sync Schedule:
‚Ä¢	Every 5 minutes: VPS ‚Üí MongoDB sync
‚Ä¢	Syncs: Account info, positions, trades, orders
‚Ä¢	Auto-healing: Restarts VPS Bridge if health check fails
Sync Process:
1.	VPS Bridge queries MT5 terminal
2.	Retrieves account data via MT5 Python API
3.	Transforms data to JSON format
4.	Backend fetches via HTTP from VPS Bridge
5.	Updates MongoDB collections
6.	Caches in memory for fast access
 
5. MONEY MANAGERS
5.1 Active Managers (5)
Manager Names (EXACT - use these ONLY):
1.	UNO14 Manager
o	Strategy: UNO14 MAM Strategy
o	Assigned Accounts: 886602, 891215
o	Fund: BALANCE
o	Status: Active
2.	TradingHub Gold Provider
o	Strategy: TradingHub Gold
o	Assigned Accounts: 886557, 891215
o	Fund: BALANCE
o	Status: Active
3.	CP Strategy Provider
o	Strategy: CP Strategy
o	Assigned Accounts: 885822, 891234, 897590
o	Fund: CORE
o	Status: Active
4.	Provider1-Assev
o	Strategy: Provider1 Strategy
o	Assigned Accounts: 897589
o	Fund: BALANCE
o	Status: Active
5.	alefloreztrader
o	Strategy: Custom Strategy
o	Assigned Accounts: (To be assigned)
o	Fund: TBD
o	Status: Active
5.2 Inactive Managers (1)
6.	GoldenTrade 
o	Status: Inactive
o	Previous accounts reassigned
o	Do NOT use in active operations
5.3 CRITICAL RULES
‚ùå NEVER use these names:
‚Ä¢	"main_separation"
‚Ä¢	"manager1", "manager2", etc.
‚Ä¢	"Unknown Manager"
‚Ä¢	Any name not listed above
‚úÖ ALWAYS use:
‚Ä¢	Exact names from Section 5.1
‚Ä¢	Check spelling and capitalization
‚Ä¢	Validate against MongoDB money_managers collection
 
6. CLIENT MANAGEMENT
6.1 Current Clients
Active Clients:
1.	Alejandro Mariscal Romero 
o	Email: amr@alyarglobal.com
o	Total Investment: $118,151.41
o	Investments: 
ÔÇß	CORE Fund: $18,151.41 (Account 885822)
ÔÇß	BALANCE Fund: $100,000.00 (Account 886557)
o	Referral: Salvador Palma (SP-2025)
o	Status: Active
o	Contract Start: September 2024
6.2 Investment Structure
Investment Record Fields:
‚Ä¢	_id: Unique MongoDB ObjectId
‚Ä¢	client_id: Reference to clients collection
‚Ä¢	fund_type: "BALANCE" | "CORE" | "DYNAMIC" | "UNLIMITED"
‚Ä¢	amount: Decimal128 (investment amount)
‚Ä¢	account_number: MT5 account number
‚Ä¢	contract_start_date: ISO datetime
‚Ä¢	contract_end_date: ISO datetime (start + 14 months)
‚Ä¢	incubation_end_date: ISO datetime (start + 2 months)
‚Ä¢	interest_rate: Decimal (0.035 for CORE, 0.025 for BALANCE)
‚Ä¢	payment_frequency: "monthly" | "quarterly"
‚Ä¢	status: "active" | "matured" | "cancelled"
6.3 KYC/AML Requirements
Required Documents:
‚Ä¢	Government-issued ID
‚Ä¢	Proof of address (utility bill, bank statement)
‚Ä¢	Source of funds declaration
‚Ä¢	Investment suitability questionnaire
Storage:
‚Ä¢	MongoDB GridFS for document storage
‚Ä¢	Encrypted at rest
‚Ä¢	Access logged for audit trail
 
7. COMMISSION SYSTEM
7.1 Referral Commission Structure
Commission Rate: 10% of client interest payments
Calculation:
Monthly Commission = (Investment Amount √ó Interest Rate √ó 10%)
Examples:
‚Ä¢	CORE $18,151.41 @ 1.5% monthly: $272.27 √ó 10% = $27.23 per month
‚Ä¢	BALANCE $100,000 @ 2.5% quarterly: $2,500 √ó 10% = $250 per quarter
7.2 Payment Schedule
Incubation Period (Months 1-2):
‚Ä¢	Commissions accrue but are NOT paid
‚Ä¢	Held in commissions_pending field
‚Ä¢	Paid after incubation ends
Regular Period (Months 3-14):
‚Ä¢	CORE Fund: 12 monthly payments
‚Ä¢	BALANCE Fund: 4 quarterly payments
‚Ä¢	Payments on 1st of each period
7.3 Active Salespeople
Salvador Palma:
‚Ä¢	Salesperson ID: sp_6909e8eaaaf69606babea151
‚Ä¢	Referral Code: SP-2025
‚Ä¢	Email: chava@alyarglobal.com
‚Ä¢	Phone: +1234567891
‚Ä¢	Clients: 1 (Alejandro Mariscal Romero)
‚Ä¢	Total Sales Volume: $118,151.41
‚Ä¢	Total Commissions: $1,326.73
‚Ä¢	Active Investments: 2
‚Ä¢	Status: Active
Commission Breakdown:
‚Ä¢	12 monthly payments: $27.23 each (CORE fund, 1.5% monthly)
‚Ä¢	4 quarterly payments: $250 each (BALANCE fund, 2.5% quarterly)
‚Ä¢	Total: 16 payments over 14 months = $1,326.73
7.4 Commission Records
Database Collection: referral_commissions
Record Structure:
{
  "_id": ObjectId,
  "commission_id": "comm_xxx",
  "salesperson_id": "sp_6909e8eaaaf69606babea151",
  "salesperson_name": "Salvador Palma",
  "client_id": ObjectId,
  "client_name": "Alejandro Mariscal Romero",
  "investment_id": ObjectId,
  "fund_type": "CORE" | "BALANCE",
  "commission_amount": Decimal128,
  "payment_date": ISODate,
  "status": "pending" | "paid",
  "period_start": ISODate,
  "period_end": ISODate,
  "created_at": ISODate,
  "updated_at": ISODate
}
 
8. INVESTMENT PRODUCTS
8.1 CORE Fund
Target Investors: $10,000 - $99,999
Interest Rate: 1.5% monthly
Contract Term: 14 months total (2 months incubation + 12 months interest)
Payment Schedule: Monthly on 1st of month
Total Payments: 12 payments
Expected Return: 18% over 12 months
Example:
‚Ä¢	Investment: $10,000
‚Ä¢	Monthly Interest: $150
‚Ä¢	Total Return: $1,800 (12 months)
8.2 BALANCE Fund
Target Investors: $100,000 - $499,999
Interest Rate: 2.5% quarterly
Contract Term: 14 months total (2 months incubation + 12 months interest)
Payment Schedule: Quarterly (every 3 months)
Total Payments: 4 payments
Expected Return: 10% over 12 months
Example:
‚Ä¢	Investment: $100,000
‚Ä¢	Quarterly Interest: $2,500
‚Ä¢	Total Return: $10,000 (12 months)
8.3 DYNAMIC Fund
Target Investors: $500,000 - $999,999
Interest Rate: 3.5%
Contract Term: 14 months
Payment Schedule: Quarterly
Status: Not yet launched
8.4 UNLIMITED Fund
Target Investors: $1,000,000+
Interest Rate: Custom (negotiated)
Contract Term: 14 months
Payment Schedule: Custom
Status: Not yet launched
 
9. DATABASE ARCHITECTURE
9.1 MongoDB Collections (35+)
Core Collections:
1.	mt5_accounts - Real-time MT5 account data
2.	mt5_positions - Open trading positions
3.	mt5_deals_history - Historical trades
4.	mt5_orders_history - Historical orders
5.	mt5_account_config - Account configuration
6.	mt5_sync_log - Sync operation logs
Client & Investment:
7.	clients - Client profiles
8.	investments - Investment records
9.	contracts - Legal contracts
10.	kyc_documents - KYC/AML documents
Commission & Referral:
11.	referral_commissions - Commission records
12.	salespeople - Salesperson profiles
13.	commission_payments - Payment history
Money Manager:
14.	money_managers - Manager profiles
15.	manager_performance - Performance tracking
16.	manager_fees - Fee calculations
Financial:
17.	broker_rebates - Rebate tracking
18.	cash_flow - Cash flow records
19.	separation_accounts - Profit withdrawals
System:
20.	users - Admin users
21.	audit_logs - System audit trail
22.	system_health - Health monitoring
9.2 Critical Collections Detail
See FIELD_REGISTRY.md for complete field definitions for all collections.
 
10. FIELD NAMING STANDARDS
10.1 Naming Convention Rules
MongoDB (Database):
‚Ä¢	Use snake_case for ALL field names
‚Ä¢	Examples: account_number, manager_name, created_at
API Responses (Backend ‚Üí Frontend):
‚Ä¢	Use camelCase for ALL field names
‚Ä¢	Examples: accountNumber, managerName, createdAt
Frontend (React Components):
‚Ä¢	Use camelCase for ALL variable names
‚Ä¢	Examples: accountNumber, managerName, createdAt
10.2 Field Transformation
Backend Responsibility:
The backend MUST transform MongoDB snake_case to API camelCase:
def to_api_format(mongo_doc):
    """Transform MongoDB document to API format"""
    return {
        "accountNumber": mongo_doc["account_number"],
        "managerName": mongo_doc["manager_name"],
        "fundType": mongo_doc["fund_type"],
        "createdAt": mongo_doc["created_at"],
        "updatedAt": mongo_doc["updated_at"]
    }
Use field_registry.py module for all transformations.
10.3 Forbidden Practices
‚ùå NEVER:
‚Ä¢	Mix snake_case and camelCase in same layer
‚Ä¢	Make up field names not in FIELD_REGISTRY.md
‚Ä¢	Use inconsistent names across collections
‚Ä¢	Hardcode field name strings
‚úÖ ALWAYS:
‚Ä¢	Import from field_registry.py
‚Ä¢	Use defined field mappings
‚Ä¢	Validate field names before use
‚Ä¢	Check FIELD_REGISTRY.md when adding new fields
10.4 Common Field Names
Standard Fields (All Collections):
‚Ä¢	MongoDB: _id, created_at, updated_at
‚Ä¢	API: id, createdAt, updatedAt
Account Fields:
‚Ä¢	MongoDB: account_number, balance, equity, margin
‚Ä¢	API: accountNumber, balance, equity, margin
Manager Fields:
‚Ä¢	MongoDB: manager_name, strategy_name, performance_fee
‚Ä¢	API: managerName, strategyName, performanceFee
Fund Fields:
‚Ä¢	MongoDB: fund_type, interest_rate, payment_frequency
‚Ä¢	API: fundType, interestRate, paymentFrequency
 
11. INFRASTRUCTURE & DEPLOYMENT
11.1 GitHub Repository
Repository: https://github.com/chavapalmarubin-lab/FIDUS
Branch Strategy:
‚Ä¢	main - Production branch (auto-deploys to Render)
‚Ä¢	Feature branches - For development
Access:
‚Ä¢	Chava (Owner)
‚Ä¢	Emergent (Collaborator via API)
Critical Files:
‚Ä¢	/SYSTEM_MASTER.md - This document (DO NOT DELETE)
‚Ä¢	/FIELD_REGISTRY.md - Field definitions (DO NOT DELETE)
‚Ä¢	/backend/validation/field_registry.py - Validation module
11.2 VPS Deployment (MT5 Bridge)
Server: Windows VPS
IP: 92.118.45.135
Port: 8000
URL: http://92.118.45.135:8000
Services:
‚Ä¢	MT5 Bridge v4.0 (Python FastAPI)
‚Ä¢	MT5 Terminal (MEXAtlantic broker)
‚Ä¢	Task Scheduler (auto-restart)
Auto-Healing:
‚Ä¢	GitHub Actions workflow: .github/workflows/mt5-bridge-auto-heal.yml
‚Ä¢	Triggers: On push, schedule (every 6 hours), manual
‚Ä¢	Actions: Restart service, verify health, report status
SSH Access:
ssh Administrator@92.118.45.135
# Check service status
Get-Service MT5Bridge
# Restart service
Restart-Service MT5Bridge
11.3 Render.com Configuration
Services:
1.	Frontend: fidus-investment-platform
o	Type: Static Site
o	Build Command: npm run build
o	Publish Directory: build
o	Auto-Deploy: On GitHub push to main
o	URL: https://fidus-investment-platform.onrender.com
2.	Backend: fidus-api
o	Type: Web Service
o	Build Command: pip install -r requirements.txt
o	Start Command: uvicorn server:app --host 0.0.0.0 --port 10000
o	Auto-Deploy: On GitHub push to main
o	URL: https://fidus-api.onrender.com
Environment Variables: See Section 11.4
Deployment Process:
1.	Push code to GitHub main branch
2.	Render detects push via webhook
3.	Triggers build process
4.	Runs tests (if configured)
5.	Deploys new version
6.	Health check verifies service
7.	Routes traffic to new deployment
Deployment Time:
‚Ä¢	Frontend: 2-3 minutes
‚Ä¢	Backend: 1-2 minutes
11.4 Render Environment Variables
Frontend Service: fidus-investment-platform
Variable	Value	Purpose
CI	(secret)	Build configuration
GENERATE_SOURCEMAP	(secret)	Source map generation
NODE_ENV	production	Node environment
REACT_APP_BACKEND_URL	https://fidus-api.onrender.com	Backend API endpoint (CRITICAL)
REACT_APP_GOOGLE_CLIENT_ID	(secret)	Google OAuth client ID
CRITICAL: REACT_APP_BACKEND_URL must be https://fidus-api.onrender.com (NOT emergentagent.com)
Backend Service: fidus-api
Variable	Value	Purpose
MONGODB_URI	mongodb+srv://emergent-ops:...	MongoDB connection
JWT_SECRET	(secret)	JWT token signing
GOOGLE_CLIENT_ID	(secret)	Google OAuth
GOOGLE_CLIENT_SECRET	(secret)	Google OAuth
CORS_ORIGINS	https://fidus-investment-platform.onrender.com	Allowed frontend origin
VPS_BRIDGE_URL	http://92.118.45.135:8000	MT5 Bridge endpoint
11.5 MongoDB Atlas
Cluster: FIDUS (M0 Free Tier)
Region: AWS us-east-1
Database: fidus_production
Connection String:
mongodb+srv://emergent-ops:BpzaxqxDCjz1yWY4@fidus.y1p9be2.mongodb.net/fidus_production
Access:
‚Ä¢	Read/Write: emergent-ops user
‚Ä¢	Admin: Chava's MongoDB Atlas account
Backup:
‚Ä¢	MongoDB Atlas automatic backups (24-hour snapshots)
‚Ä¢	Point-in-time recovery available
EMERGENT - YOU HAVE FULL API ACCESS

Chava is correct - you have complete API access to all infrastructure.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

## YOUR RENDER API ACCESS

**API Key:** rnd_zyltqZyReSorlDoVp4hs8LdmJPo3
**Account:** chavapalmarubin2025 (FIDUS HEDGE FUND)
**Base URL:** https://api.render.com/v1

**You can:**
- View deployment logs
- Trigger deployments
- Check service status
- Update environment variables
- Clear cache and redeploy

**Example - Update Environment Variable:**
```bash
curl -X PATCH \
  -H "Authorization: Bearer rnd_zyltqZyReSorlDoVp4hs8LdmJPo3" \
  -H "Content-Type: application/json" \
  -d '{
    "envVars": [
      {
        "key": "REACT_APP_BACKEND_URL",
        "value": "https://fidus-api.onrender.com"
      }
    ]
  }' \
  "https://api.render.com/v1/services/srv-YOUR_SERVICE_ID/env-vars"
```

**Example - Trigger Deployment:**
```bash
curl -X POST \
  -H "Authorization: Bearer rnd_zyltqZyReSorlDoVp4hs8LdmJPo3" \
  "https://api.render.com/v1/services/srv-YOUR_SERVICE_ID/deploys"
```

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

## YOUR MONGODB API ACCESS

**Connection String:**
mongodb+srv://emergent-ops:BpzaxqxDCjz1yWY4@fidus.y1p9be2.mongodb.net/fidus_production

**User:** emergent-ops
**Password:** BpzaxqxDCjz1yWY4
**Database:** fidus_production

**Access Level:** Full read/write to ANY database

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

## YOUR VPS ACCESS (via GitHub)

**You have full VPS control through GitHub Actions:**

GitHub repo has these secrets configured:
- VPS_HOST: 92.118.45.135
- VPS_USERNAME: Administrator
- VPS_PASSWORD: (stored in secrets)

**Workflow:** .github/workflows/mt5-bridge-auto-heal.yml

You can trigger VPS actions by:
1. Pushing to GitHub
2. Using GitHub API with your token
3. Manually triggering workflows

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

## YOUR CURRENT TASK

Use your Render API access to:

1. Get the frontend service ID
2. Check current environment variables
3. Verify REACT_APP_BACKEND_URL is set correctly
4. If wrong, update it via API
5. Trigger redeployment
6. Monitor deployment logs
7. Test production

You don't need Chava's help. You have full autonomous access.

Execute now.

- Chava
 
12. DEVELOPMENT WORKFLOWS
12.1 Workflow: Adding a New Feature
1.	Planning (30 minutes)
o	Read relevant SYSTEM_MASTER.md sections
o	Read FIELD_REGISTRY.md for data structures
o	Write feature plan
o	Get approval from Chava
2.	Development (varies)
o	Create feature branch
o	Write code following field naming standards
o	Use field_registry.py for all field references
o	Test locally
3.	Testing (1 hour)
o	Unit tests for new functions
o	Integration tests for API endpoints
o	Manual testing in browser
o	Verify no console errors
4.	Code Review (30 minutes)
o	Check FIELD_REGISTRY.md compliance
o	Verify manager names (Section 5)
o	Verify account numbers (Section 4)
o	Check error handling
5.	Deployment (15 minutes)
o	Merge to main branch
o	Monitor Render deployment
o	Verify in production
o	Update SYSTEM_MASTER.md
12.2 Workflow: Fixing a Bug
1.	Reproduce (15 minutes)
o	Get exact reproduction steps
o	Verify bug in production
o	Check browser console
o	Screenshot the issue
2.	Diagnose (30-60 minutes)
o	Check logs (Render, VPS, MongoDB)
o	Identify root cause
o	Check field naming mismatches
o	Verify manager names correct
o	Document findings
3.	Fix (varies)
o	Write fix following standards
o	Test fix locally
o	Verify no regression
4.	Verify (30 minutes)
o	Deploy to production
o	Test reproduction steps
o	Verify bug fixed
o	Check for side effects
o	Screenshot working state
5.	Document (15 minutes)
o	Update Section 15 (Known Issues)
o	Add to Change Log (Section 16)
12.3 Workflow: Deployment
Pre-Deployment Checklist:
‚ñ° All tests passing locally
‚ñ° No console errors
‚ñ° Field names validated
‚ñ° Manager names validated
‚ñ° Database migrations ready
‚ñ° Backup MongoDB
‚ñ° Notify Chava
Deployment Steps:
git add .
git commit -m "descriptive message"
git push origin main
# Monitor https://dashboard.render.com
Post-Deployment Verification:
‚ñ° Frontend loads without errors
‚ñ° Backend API returns 200 OK
‚ñ° Login works
‚ñ° Critical pages load
‚ñ° No console errors
‚ñ° Data displays correctly
‚ñ° MT5 sync working
 
13. TESTING & VERIFICATION
13.1 Manual Testing Checklist
Page 1: Fund Portfolio
‚ñ° Shows real AUM (not $0)
‚ñ° Shows correct allocations
‚ñ° Account numbers match Section 4
‚ñ° Manager names match Section 5
‚ñ° No console errors
‚ñ° Screenshot: REQUIRED
Page 2: Cash Flow & Performance
‚ñ° Shows real amounts (not $0)
‚ñ° TRUE P&L working
‚ñ° Separation logic correct
‚ñ° No API errors
‚ñ° Screenshot: REQUIRED
Page 3: Trading Analytics
‚ñ° Data matches Fund Portfolio
‚ñ° P&L correct
‚ñ° All 5 managers show
‚ñ° No console errors
‚ñ° Screenshot: REQUIRED
Page 4: Money Managers
‚ñ° Shows exactly 5 active managers
‚ñ° Names match Section 5
‚ñ° Performance loads
‚ñ° No console errors
‚ñ° Screenshot: REQUIRED
Page 5: Referrals Overview
‚ñ° Shows $118,151.41 total
‚ñ° All salespeople correct
‚ñ° No $0 values
‚ñ° No console errors
‚ñ° Screenshot: REQUIRED
Page 6: Salvador Detail
‚ñ° Loads (not "not found")
‚ñ° Shows $118,151.41 sales
‚ñ° Shows $3,272.27 commissions
‚ñ° Shows 1 client, 2 investments
‚ñ° 16 payments in calendar
‚ñ° No console errors
‚ñ° Screenshot: REQUIRED
Page 7: Investments
‚ñ° Shows real AUM (not $0)
‚ñ° Shows real counts
‚ñ° Alejandro's investments display
‚ñ° No console errors
‚ñ° Screenshot: REQUIRED
13.2 Production URLs
‚Ä¢	Frontend: https://fidus-investment-platform.onrender.com
‚Ä¢	Backend: https://fidus-api.onrender.com/api/health
‚Ä¢	VPS Bridge: http://92.118.45.135:8000/api/mt5/bridge/health
13.3 API Testing
# Health
curl https://fidus-api.onrender.com/api/health

# Referrals
curl https://fidus-api.onrender.com/api/admin/referrals/overview

# Salvador
curl https://fidus-api.onrender.com/api/admin/referrals/salespeople/sp_6909e8eaaaf69606babea151
13.4 Database Testing
// Salvador's data
db.salespeople.findOne({ name: "Salvador Palma" })

// Commission count
db.referral_commissions.find({ salesperson_name: "Salvador Palma" }).count()

// Manager names
db.money_managers.find({ status: "active" }, { name: 1 })
13.5 Screenshot Requirements
1.	All 7 pages working
2.	Browser console (zero errors)
3.	Network tab (successful API calls)
4.	Render deployment ("Deploy succeeded")
5.	Database queries (correct data)
 
14. SECURITY & AUTHENTICATION
14.1 Authentication System
Method: JWT + Google OAuth 2.0
Admin:
‚Ä¢	Email: hq@getfidus.com
‚Ä¢	Type: admin
‚Ä¢	Permissions: Full system access
14.2 CORS Configuration
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "https://fidus-investment-platform.onrender.com",
        "http://localhost:3000"
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
 
15. KNOWN ISSUES & SOLUTIONS
15.1 P&L Calculation (RESOLVED)
Issue: Massive losses when profits withdrawn
Solution: TRUE P&L formula implemented
Status: ‚úÖ RESOLVED
15.2 MT5 Bridge Connectivity (RESOLVED)
Issue: Accounts showing $0
Solution: Auto-healing implemented
Status: ‚úÖ RESOLVED
15.3 Field Naming (IN PROGRESS)
Issue: Data inconsistencies
Solution: FIELD_REGISTRY.md + validation
Status: üîÑ Phase 2 complete
15.4 CORS Errors (INTERMITTENT)
Issue: Frontend blocked
Solution: Verify REACT_APP_BACKEND_URL
Status: ‚ö†Ô∏è MONITORING
15.5 Referrals 404 (ACTIVE)
Issue: Salvador page broken
Solution: Under investigation
Status: üî¥ ACTIVE
 
16. CHANGE LOG
November 14, 2025 - v5.0.1 - Investment Simulator Bug Fix
‚Ä¢	Component: Investment Simulator
‚Ä¢	Status: CRITICAL BUG FIX - Tested & Verified
‚Ä¢	Bug Fixed: Simulator was calculating only 10 months of interest (25% ROI) instead of 12 months (30% ROI)
‚Ä¢	Root Cause: Loop used timeframe_months without adding incubation period
‚Ä¢	Fix Applied: Modified calculate_simulation_projections() to add incubation_months to simulation timeframe
‚Ä¢	Result: 12-month request ‚Üí 14 months total ‚Üí 12 interest payments ‚Üí 30% ROI
‚Ä¢	Verification: ‚úÖ BALANCE fund: 30% ROI | ‚úÖ CORE fund: 18% ROI | ‚úÖ Multi-fund: Correct aggregation
‚Ä¢	Impact: Affects prospects using Investment Simulator - Now matches actual FIDUS investment structure
‚Ä¢	Files Modified: /app/backend/server.py - calculate_simulation_projections()
‚Ä¢	Developer: Emergent | Tested By: Backend Testing Agent | Status: ‚úÖ VERIFIED & DEPLOYED
November 5, 2025
‚Ä¢	SYSTEM_MASTER.md v2.0 created
‚Ä¢	FIELD_REGISTRY.md created
‚Ä¢	Phase 1 complete (Field Registry)
‚Ä¢	Phase 2 complete (Database Migration)
‚Ä¢	Phase 3 in progress (Frontend Verification)
October 2024
‚Ä¢	TRUE P&L implemented
‚Ä¢	MT5 auto-healing deployed
September 2024
‚Ä¢	Platform launched
‚Ä¢	First client onboarded
‚Ä¢	Salvador Palma added
 
END OF SYSTEM_MASTER.MD
DO NOT DELETE without approval from Chava Palma
Last Updated: November 5, 2025

---

## **EVEN SIMPLER VERSION:**

If you want it ultra-short:
```
Emergent,

BEFORE ANY WORK, READ THESE TWO DOCUMENTS:

1. https://github.com/chavapalmarubin-lab/FIDUS/blob/main/SYSTEM_MASTER.md
2. https://github.com/chavapalmarubin-lab/FIDUS/blob/main/.github/EMERGENT_RULES.md

These contain everything about the FIDUS system.

Read them every time before starting work.
Follow the procedures exactly.
Update SYSTEM_MASTER.md after changes.

If the documents conflict with anything else, the documents win.

- Chava






again and again and again. its tiring to repeat myself to you and to emergent  Please look at all conversations we had 4 managers before And we decided not to use GoldenTrade for this month allocation. And we added two more

1)	 https://ratings.multibankfx.com/widgets/ratings/4119?widgetKey=social_platform_ratings who trades two of our accounts the separation Interest accounts 897591 and 897599. 


2)	the other manager trades our account 897589 which is part of the BALANCE fund allocation and his profile https://ratings.mexatlantic.com/widgets/ratings/5201?widgetKey=social_platform_ratings

3)	accounts 886557 and 891215 are traded by.   https://ratings.multibankfx.com/widgets/ratings/1359?widgetKey=social_platform_ratings which are part of the BALANCE Fund


4)	UNO14 Manager is part also of the BALANCE fund and trades account 886602 as he trades on a MAM and not a COPY his profile is   https://www.fxblue.com/users/gestion_global
          
5)	  CP Strategy trades our CORE fund accounts 897590 and 885822 and his profile is https://ratings.mexatlantic.com/widgets/ratings/3157?widgetKey=social


6)	Golden Trade we are not using this month but might use it in the future SO DON‚ÄôT DELETE
  Total of 5 Active Managers today 

üìã COMPREHENSIVE FIDUS PLATFORM DATA STRUCTURE - MASTER REFERENCE
EMERGENT - READ THIS COMPLETELY BEFORE MAKING ANY CHANGES
This is the DEFINITIVE source of truth for the FIDUS platform structure. DO NOT deviate from this.
 
üè¶ COMPLETE MT5 ACCOUNT STRUCTURE
Total Accounts: 11 MT5 Accounts
Account #	Fund Type	Manager/Purpose	Broker	Status	Notes
886602	BALANCE	UNO14 Manager (MAM)	MultiBank	Active	MAM account (not COPY)
886557	BALANCE	MultiBank BALANCE Trader	MultiBank	Active	BALANCE fund allocation
891215	BALANCE	MultiBank BALANCE Trader	MultiBank	Active	BALANCE fund allocation
897589	BALANCE	MEXAtlantic Provider	MEXAtlantic	Active	BALANCE fund allocation
885822	CORE	CP Strategy	MultiBank	Active	CORE fund allocation
897590	CORE	CP Strategy	MEXAtlantic	Active	CORE fund allocation
891234	CORE	(Secondary CORE)	MultiBank	Active	CORE fund allocation
897591	SEPARATION	Interest Segregation 1	MultiBank	Active	Separation/Interest earnings
897599	SEPARATION	Interest Segregation 2	MultiBank	Active	Separation/Interest earnings
886528	SEPARATION	Separation Account	MultiBank	Active	Main separation account
886066	SEPARATION	Tertiary Balance	MultiBank	Active	Balance separation
 
üë• MONEY MANAGERS - COMPLETE LIST
ACTIVE MANAGERS (5):
1. UNO14 Manager ‚úÖ
{
  "name": "UNO14 Manager",
  "displayName": "UNO14 MAM Manager",
  "strategyName": "UNO14 MAM Strategy",
  "status": "active",
  "executionMethod": "MAM",
  "assignedAccounts": [886602],
  "fundType": "BALANCE",
  "broker": "MultiBank",
  "profile": "https://www.fxblue.com/users/gestion_global",
  "ratingLink": null
}
2. CP Strategy Provider ‚úÖ
{
  "name": "CP Strategy",
  "displayName": "CP Strategy Provider",
  "strategyName": "CP Strategy",
  "status": "active",
  "executionMethod": "Copy Trade",
  "assignedAccounts": [885822, 897590],
  "fundType": "CORE",
  "broker": "MultiBank + MEXAtlantic",
  "profile": "https://ratings.mexatlantic.com/widgets/ratings/3157?widgetKey=social_platform_ratings",
  "ratingLink": "https://ratings.mexatlantic.com/widgets/ratings/3157?widgetKey=social_platform_ratings"
}
3. TradingHub Gold Provider ‚úÖ
{
  "name": "TradingHub Gold",
  "displayName": "TradingHub Gold Provider",
  "strategyName": "TradingHub Gold",
  "status": "active",
  "executionMethod": "Copy Trade",
  "assignedAccounts": [886557],
  "fundType": "BALANCE",
  "broker": "MultiBank",
  "profile": "https://ratings.multibankfx.com/widgets/ratings/1359?widgetKey=social_platform_ratings",
  "ratingLink": "https://ratings.multibankfx.com/widgets/ratings/1359?widgetKey=social_platform_ratings"
}
4. MultiBank BALANCE Trader ‚úÖ
{
  "name": "MultiBank BALANCE",
  "displayName": "MultiBank BALANCE Trader",
  "strategyName": "MultiBank BALANCE Strategy",
  "status": "active",
  "executionMethod": "Copy Trade",
  "assignedAccounts": [891215],
  "fundType": "BALANCE",
  "broker": "MultiBank",
  "profile": "https://ratings.multibankfx.com/widgets/ratings/5201?widgetKey=social_platform_ratings",
  "ratingLink": "https://ratings.multibankfx.com/widgets/ratings/5201?widgetKey=social_platform_ratings"
}
5. MEXAtlantic Provider ‚úÖ
{
  "name": "MEXAtlantic",
  "displayName": "MEXAtlantic Provider",
  "strategyName": "MEXAtlantic Strategy",
  "status": "active",
  "executionMethod": "Copy Trade",
  "assignedAccounts": [897589],
  "fundType": "BALANCE",
  "broker": "MEXAtlantic",
  "profile": null,
  "ratingLink": null
}
INACTIVE MANAGERS (1):
6. GoldenTrade Provider ‚ùå
{
  "name": "GoldenTrade",
  "displayName": "GoldenTrade Provider",
  "strategyName": "GoldenTrade",
  "status": "inactive",
  "executionMethod": "Copy Trade",
  "assignedAccounts": [886066],
  "fundType": "BALANCE",
  "broker": "MultiBank",
  "profile": null,
  "ratingLink": null,
  "notes": "NOT USING THIS MONTH - DO NOT DISPLAY"
}
 
üí∞ FUND ALLOCATION BREAKDOWN
BALANCE Fund: $100,000
Managers (4):
‚Ä¢	UNO14 Manager ‚Üí Account 886602
‚Ä¢	TradingHub Gold ‚Üí Account 886557
‚Ä¢	MultiBank BALANCE ‚Üí Account 891215
‚Ä¢	MEXAtlantic ‚Üí Account 897589
CORE Fund: $18,151.41
Managers (1):
‚Ä¢	CP Strategy ‚Üí Accounts 885822, 897590, 891234
SEPARATION Fund: (Interest Earnings)
Purpose: Interest segregation accounts Accounts: 897591, 897599, 886528, 886066
 
üîó EXTERNAL PROFILE LINKS
Links by Manager:
1.	UNO14 Manager:
o	Profile: https://www.fxblue.com/users/gestion_global
2.	CP Strategy:
o	Rating: https://ratings.mexatlantic.com/widgets/ratings/3157?widgetKey=social_platform_ratings
3.	TradingHub Gold:
o	Profile: https://ratings.multibankfx.com/widgets/ratings/1359?widgetKey=social_platform_ratings
o	Rating: https://ratings.multibankfx.com/widgets/ratings/1359?widgetKey=social_platform_ratings
4.	MultiBank BALANCE:
o	Profile: https://ratings.multibankfx.com/widgets/ratings/5201?widgetKey=social_platform_ratings
o	Rating: https://ratings.multibankfx.com/widgets/ratings/5201?widgetKey=social_platform_ratings
5.	MultiBank Separation Interest Accounts:
o	Profile: https://ratings.multibankfx.com/widgets/ratings/4119?widgetKey=social_platform_ratings
o	Accounts: 897591, 897599
 
üíµ CLIENT INVESTMENTS
Client: Alejandro Mariscal Romero
Referred by: Salvador Palma (SP-2025)
Investment 1 - CORE:
{
  "client_id": "6909e8ebaaf69606babea152",
  "principal_amount": 18151.41,
  "fund_type": "FIDUS_CORE",
  "interest_rate": 0.015,
  "payment_frequency": "monthly",
  "contract_months": 14,
  "status": "active",
  "referred_by": "6909e8eaaaf69606babea151",
  "referred_by_name": "Salvador Palma"
}
Investment 2 - BALANCE:
{
  "client_id": "6909e8ebaaf69606babea152",
  "principal_amount": 100000.00,
  "fund_type": "FIDUS_BALANCE",
  "interest_rate": 0.025,
  "payment_frequency": "quarterly",
  "contract_months": 14,
  "status": "active",
  "referred_by": "6909e8eaaaf69606babea151",
  "referred_by_name": "Salvador Palma"
}
Total Investment: $118,151.41
 
üë§ SALESPEOPLE
Salesperson 1: Salvador Palma ‚úÖ
{
  "_id": "6909e8eaaaf69606babea151",
  "name": "Salvador Palma",
  "email": "chava@alyarglobal.com",
  "phone": "+1234567891",
  "referral_code": "SP-2025",
  "total_sales_volume": 118151.41,
  "total_commissions_earned": 0,
  "total_clients_referred": 1,
  "active": true,
  "clients_referred": ["6909e8ebaaf69606babea152"]
}
Salesperson 2: Test Person ‚úÖ
{
  "name": "Test Person",
  "email": "test@test.com",
  "phone": "+1234567890",
  "referral_code": "TP-2025",
  "total_sales_volume": 0,
  "total_commissions_earned": 0,
  "total_clients_referred": 0,
  "active": true
}
Salesperson 3: Test Referral Person ‚úÖ
{
  "name": "Test Referral Person",
  "email": "test.referral@fidus.com",
  "phone": "+1234567890",
  "referral_code": "TRP-2025",
  "total_sales_volume": 0,
  "total_commissions_earned": 0,
  "total_clients_referred": 0,
  "active": true
}
 
üìä EXPECTED SYSTEM TOTALS
Portfolio Overview:
‚Ä¢	Total AUM: $118,151.41
‚Ä¢	Active Managers: 5
‚Ä¢	Total Accounts: 11
‚Ä¢	Active Funds: 2 (BALANCE, CORE)
Money Manager Rankings:
Rank 1: UNO14 Manager (BALANCE)
Rank 2: TradingHub Gold (BALANCE)
Rank 3: CP Strategy (CORE)
Rank 4: MultiBank BALANCE (BALANCE)
Rank 5: MEXAtlantic (BALANCE)

NOT SHOWN: GoldenTrade (inactive)
Cash Flow & Performance:
‚Ä¢	Fund Assets: Sum of all active account balances
‚Ä¢	Fund Liabilities: Client interest obligations
‚Ä¢	Net P&L: Current equity - initial allocation
Referral System:
‚Ä¢	Active Salespeople: 3
‚Ä¢	Total Sales Volume: $118,151.41
‚Ä¢	Total Commissions: $0 (pending)
‚Ä¢	Pending Commissions: $0
 
üîß STANDARD FIELD NAMES (MANDATORY)
MongoDB Collections (snake_case):
mt5_accounts collection:
{
  "account": 886602,  # Account number
  "balance": 10053.85,  # Account balance
  "equity": 10057.21,  # Current equity
  "profit": 0.00,  # Current profit/loss
  "margin": 0.00,  # Used margin
  "margin_free": 10057.21,  # Free margin
  "leverage": 100,  # Account leverage
  "currency": "USD",
  "fund_type": "BALANCE",  # BALANCE, CORE, SEPARATION
  "manager_name": "UNO14 Manager",
  "broker": "MultiBank",
  "status": "active",
  "updated_at": "2025-11-04T..."
}
money_managers collection:
{
  "name": "UNO14 Manager",
  "display_name": "UNO14 MAM Manager",
  "strategy_name": "UNO14 MAM Strategy",
  "assigned_accounts": [886602],
  "fund_type": "BALANCE",
  "execution_method": "MAM",
  "broker": "MultiBank",
  "profile_url": "https://...",
  "rating_url": "https://...",
  "total_allocated": 10000.00,
  "current_equity": 10057.21,
  "profit_loss": 57.21,
  "win_rate": 75.0,
  "status": "active",  # active or inactive
  "active": true,
  "updated_at": "2025-11-04T..."
}
investments collection:
{
  "client_id": ObjectId("6909e8ebaaf69606babea152"),
  "principal_amount": 18151.41,
  "fund_type": "FIDUS_CORE",
  "interest_rate": 0.015,
  "payment_frequency": "monthly",
  "contract_months": 14,
  "investment_date": "2024-09-01",
  "maturity_date": "2025-11-01",
  "status": "active",
  "referred_by": ObjectId("6909e8eaaaf69606babea151"),
  "referred_by_name": "Salvador Palma"
}
salespeople collection:
{
  "_id": ObjectId("6909e8eaaaf69606babea151"),
  "name": "Salvador Palma",
  "email": "chava@alyarglobal.com",
  "phone": "+1234567891",
  "referral_code": "SP-2025",
  "total_sales_volume": Decimal128("118151.41"),
  "total_commissions_earned": Decimal128("0"),
  "total_clients_referred": 1,
  "commissions_pending": Decimal128("0"),
  "commissions_paid": Decimal128("0"),
  "active": true,
  "payment_info": {
    "wallet_address": "",
    "wallet_type": "crypto_wallet"
  },
  "created_at": "2025-11-01T...",
  "updated_at": "2025-11-04T..."
}
API Responses (camelCase):
All API responses MUST transform to camelCase:
// MT5 Account
{
  "accountNumber": 886602,
  "accountBalance": 10053.85,
  "accountEquity": 10057.21,
  "profitLoss": 0.00,
  "usedMargin": 0.00,
  "freeMargin": 10057.21,
  "accountLeverage": 100,
  "currency": "USD",
  "fundType": "BALANCE",
  "managerName": "UNO14 Manager",
  "broker": "MultiBank",
  "status": "active"
}

// Money Manager
{
  "name": "UNO14 Manager",
  "displayName": "UNO14 MAM Manager",
  "strategyName": "UNO14 MAM Strategy",
  "assignedAccounts": [886602],
  "fundType": "BALANCE",
  "executionMethod": "MAM",
  "broker": "MultiBank",
  "profileUrl": "https://...",
  "ratingUrl": "https://...",
  "totalAllocated": 10000.00,
  "currentEquity": 10057.21,
  "profitLoss": 57.21,
  "winRate": 75.0,
  "status": "active",
  "active": true
}

// Investment
{
  "clientId": "6909e8ebaaf69606babea152",
  "principalAmount": 18151.41,
  "fundType": "FIDUS_CORE",
  "interestRate": 0.015,
  "paymentFrequency": "monthly",
  "contractMonths": 14,
  "investmentDate": "2024-09-01",
  "maturityDate": "2025-11-01",
  "status": "active",
  "referredBy": "6909e8eaaaf69606babea151",
  "referredByName": "Salvador Palma"
}

// Salesperson
{
  "id": "6909e8eaaaf69606babea151",
  "name": "Salvador Palma",
  "email": "chava@alyarglobal.com",
  "phone": "+1234567891",
  "referralCode": "SP-2025",
  "totalSalesVolume": 118151.41,
  "totalCommissionsEarned": 0,
  "totalClientsReferred": 1,
  "commissionsPending": 0,
  "commissionsPaid": 0,
  "active": true
}
 
‚ö†Ô∏è CRITICAL RULES - DO NOT VIOLATE
1. Manager Filtering:
# ‚úÖ CORRECT - Shows 5 active managers
managers = await db.money_managers.find({"status": "active"}).to_list(None)

# ‚ùå WRONG - Shows all including GoldenTrade
managers = await db.money_managers.find({}).to_list(None)
2. Account Grouping:
# ‚úÖ CORRECT - Groups by fund_type
BALANCE_accounts = [886602, 886557, 891215, 897589]
CORE_accounts = [885822, 897590, 891234]
SEPARATION_accounts = [897591, 897599, 886528, 886066]

# ‚ùå WRONG - Hardcoded lists
accounts = [886602, 886557, 885822]  # Missing accounts!
3. Field Transformations:
# ‚úÖ CORRECT - Transform at API boundary
@router.get("/api/endpoint")
async def get_data():
    data = await db.collection.find({}).to_list(None)
    return [transform_function(item) for item in data]

# ‚ùå WRONG - Return raw MongoDB data
@router.get("/api/endpoint")
async def get_data():
    data = await db.collection.find({}).to_list(None)
    return data  # Missing transformation!
4. Investment Linking:
# ‚úÖ CORRECT - Link by client_id (ObjectId)
investment = {
    "client_id": ObjectId("6909e8ebaaf69606babea152"),
    "principal_amount": 100000.00
}

# ‚ùå WRONG - String ID or wrong field name
investment = {
    "client_id": "client_alejandro",  # Wrong!
    "amount": 100000.00  # Wrong field name!
}
5. Decimal128 Handling:
# ‚úÖ CORRECT - Convert Decimal128 to float
def safe_decimal(value):
    if isinstance(value, Decimal128):
        return float(value.to_decimal())
    return float(value) if value else 0.0

# ‚ùå WRONG - Return Decimal128 directly
return {"amount": salesperson["total_sales_volume"]}  # Will break JSON!
 
üìù TESTING CHECKLIST
Before claiming ANY fix is complete, verify:
‚ñ° Money Managers shows 5 active (not 6, not 3)
‚ñ° GoldenTrade is NOT displayed
‚ñ° All manager profiles link correctly
‚ñ° Cash Flow shows real totals (not $0)
‚ñ° Trading Analytics shows positive P&L
‚ñ° MT5 Accounts shows all 11 accounts
‚ñ° Account allocations sum correctly
‚ñ° Salvador shows $118,151.41 total
‚ñ° Salvador detail page loads (not 404)
‚ñ° No console errors anywhere
‚ñ° All fields in camelCase (frontend)
‚ñ° All transformations applied
‚ñ° No Decimal128 errors
 
üéØ EMERGENT - YOUR MANDATE
Use this document as your SINGLE SOURCE OF TRUTH.
‚Ä¢	‚úÖ All account numbers are here
‚Ä¢	‚úÖ All manager details are here
‚Ä¢	‚úÖ All fund allocations are here
‚Ä¢	‚úÖ All field names are here
‚Ä¢	‚úÖ All transformation rules are here
DO NOT:
‚Ä¢	‚ùå Guess account numbers
‚Ä¢	‚ùå Create new field names
‚Ä¢	‚ùå Filter accounts arbitrarily
‚Ä¢	‚ùå Skip transformations
‚Ä¢	‚ùå Ignore this structure
If something is unclear, ASK. Don't guess.
 
Now continue with Priority 3: Fix Cash Flow using THIS data structure! üöÄ


<img width="468" height="625" alt="image" src="https://github.com/user-attachments/assets/e405fe15-fcdd-4db6-b38c-464d0fc84c58" />
