EMERGENT - NEW MANDATORY OPERATING PROCEDURE

Before starting ANY task, you MUST read these two documents:

1. SYSTEM_MASTER.md
   https://github.com/chavapalmarubin-lab/FIDUS/blob/main/SYSTEM_MASTER.md

2. EMERGENT_RULES.md
   https://github.com/chavapalmarubin-lab/FIDUS/blob/main/.github/EMERGENT_RULES.md

═══════════════════════════════════════════════════════════════

MANDATORY WORKFLOW:

□ Step 1: Read both documents above (every time)
□ Step 2: Find the relevant section for your task
□ Step 3: Follow the documented procedures
□ Step 4: Make your changes
□ Step 5: Test and verify yourself
□ Step 6: Update SYSTEM_MASTER.md if needed
□ Step 7: Report complete with evidence

═══════════════════════════════════════════════════════════════

KEY RULES:

❌ NO MOCK DATA
❌ NO DUPLICATES  
❌ NO WRONG FIELD NAMES
❌ Broker is ALWAYS "MEXAtlantic" (never "MultiBank")

✅ BACKUP before modifying data
✅ VERIFY everything yourself before claiming done
✅ UPDATE documentation after changes

═══════════════════════════════════════════════════════════════

If SYSTEM_MASTER.md conflicts with anything else:
THE DOCUMENT WINS. ALWAYS.

Read the documents before starting any work.

- Chava
```
FIDUS INVESTMENT MANAGEMENT - SYSTEM MASTER DOCUMENTATION
Last Updated: November 25, 2025
Version: 2.2
Maintained By: Chava Palma (Founder & CEO)
 
TABLE OF CONTENTS
1.      System Overview
2.      Business Model
3.      Technology Stack
4.      MT5 Trading Accounts
    4.1 Account List
    4.2 Account Synchronization
    4.3 Investment Committee Allocation Workflow
5.      Money Managers
6.      Client Management
7.      Commission System
8.      Investment Products
9.      Database Architecture
10.     Field Naming Standards
11.     Infrastructure & Deployment
12.     Development Workflows
13.     Testing & Verification
14.     Security & Authentication
15.     Known Issues & Solutions
16.     Change Log
 
1. SYSTEM OVERVIEW
1.1 Platform Purpose
FIDUS Investment Management is a multi-manager hedge fund platform that:
•       Manages MT5 trading accounts across multiple brokers
•       Tracks real-time P&L and performance metrics
•       Handles client investments across 4 fund types
•       Processes referral commissions for salespeople
•       Provides admin dashboard for fund management
1.2 Core Functionality
Trading Operations:
•       Real-time MT5 account synchronization via VPS Bridge
•       Auto-healing system for account connectivity
•       TRUE P&L calculations accounting for withdrawals/deposits
•       Multi-manager performance tracking
Client Management:
•       Investment contract creation and tracking
•       KYC/AML document management
•       Commission payment schedules
•       Client portal for performance viewing
Financial Tracking:
•       Cash flow analysis with separation account logic
•       Broker rebate tracking
•       Manager performance fee calculations
•       Referral commission automation
 
2. BUSINESS MODEL
2.1 Fund Structure
FIDUS operates 4 investment products:
Fund Type       Min Investment  Interest Rate   Contract Term   Incubation Period
CORE    $10,000 1.5% monthly    14 months       2 months
BALANCE $100,000        2.5% quarterly  14 months       2 months
DYNAMIC $500,000        3.5%    14 months       2 months
UNLIMITED       $1,000,000      Custom  14 months       2 months
Incubation Period:
•       First 2 months of 14-month contract
•       Clients DO NOT receive interest payments
•       Interest accrues but is not paid out
•       After incubation, regular monthly/quarterly payments begin
2.2 Revenue Streams
1.      Trading Profits (Primary)
o       Generated by money managers across MT5 accounts
o       TRUE P&L formula: Current Equity - Initial Deposit + Total Withdrawals - Total Deposits
2.      Broker Rebates (Secondary)
o       Commission from trading volume
o       Tracked per account
o       ~12% of total revenue
3.      Performance Fees (Future)
o       Percentage of profits above high-water mark
o       Not yet implemented
2.3 Cost Structure
Client Obligations:
•       CORE Fund: 3.5% monthly interest ($350 per month per $10k investment)
•       BALANCE Fund: 2.5% monthly interest ($2,500 per month per $100k investment)
•       Payment frequency: Monthly for CORE/BALANCE, Quarterly for DYNAMIC/UNLIMITED
Operational Costs:
•       Manager performance fees (10-20% of profits)
•       Platform infrastructure (VPS, hosting, database)
•       Referral commissions (10% of client interest paid to salespeople)
 
3. TECHNOLOGY STACK
3.1 Frontend
Framework: React 18.2.0
Build Tool: Create React App
Routing: React Router v6
State Management: React Context API
Styling: Tailwind CSS
Charts: Recharts
HTTP Client: Axios
Hosting: Render.com
URL: https://fidus-investment-platform.onrender.com
3.2 Backend
Framework: FastAPI (Python 3.11)
Database: MongoDB Atlas
ORM: Motor (async MongoDB driver)
Authentication: JWT + Google OAuth 2.0
Task Scheduler: APScheduler
HTTP Client: httpx
Hosting: Render.com
URL: https://fidus-api.onrender.com
3.3 MT5 Integration
Bridge: Custom Python MT5 Bridge (v4.0)
Deployment: Windows VPS (92.118.45.135:8000)
Brokers: MEXAtlantic, Lucrum Capital
Protocol: HTTP REST API
Auto-Healing:
•       GitHub Actions workflows for automatic restarts
•       Task Scheduler for Windows service management
•       Health monitoring every 5 minutes
3.4 Database
Provider: MongoDB Atlas
Cluster: FIDUS (M0 Free Tier)
Database: fidus_production
Connection: mongodb+srv://emergent-ops:***SANITIZED***@fidus.y1p9be2.mongodb.net/fidus_production
Collections: 35+ (see Section 9 for complete list)
 
4. MT5 TRADING ACCOUNTS
4.1 Account List
Active MT5 Accounts (14 total):
Active MT4 Accounts (1 total):
Total Trading Accounts: 15
Account #       Fund Type       Manager Broker  Status
886557  BALANCE Master  TradingHub Gold Provider        MEXAtlantic     Active
886602  BALANCE TradingHub Gold Provider        MEXAtlantic     Active
891215  BALANCE TradingHub Gold Provider        MEXAtlantic     Active
897589  BALANCE Provider1-Assev MEXAtlantic     Active
2198    BALANCE JOSE    Lucrum Capital  Active
885822  CORE    CP Strategy Provider    MEXAtlantic     Active
891234  CORE    CP Strategy Provider    MEXAtlantic     Active
897590  CORE    CP Strategy Provider    MEXAtlantic     Active
886066  BALANCE (ZERO)  N/A     MEXAtlantic     Active
886528  SEPARATION      N/A     MEXAtlantic     Active
897591  SEPARATION      N/A     MEXAtlantic     Active
897599  SEPARATION      N/A     MEXAtlantic     Active
SEPARATION Accounts:
•       Purpose: Hold profits withdrawn from trading accounts
•       Do NOT count toward fund performance
•       Interest earnings stored here
•       Excluded from P&L calculations
ZERO Balance Accounts:
•       Account 886066 shows $0 balance
•       Account 891234 shows $0 balance
•       Normal operation - accounts may be temporarily empty
4.2 Account Synchronization
Sync Schedule:
•       Every 5 minutes: VPS → MongoDB sync
•       Syncs: Account info, positions, trades, orders
•       Auto-healing: Restarts VPS Bridge if health check fails
Sync Process:
1.      VPS Bridge queries MT5 terminal
2.      Retrieves account data via MT5 Python API
3.      Transforms data to JSON format
4.      Backend fetches via HTTP from VPS Bridge
5.      Updates MongoDB collections
6.      Caches in memory for fast access


---

## 4.2.1 HOW TO ADD NEW MT5 ACCOUNTS (LUCRUM)

### Quick Reference
- **Server Name:** `LucrumCapital-Trade` (MUST be exact - case sensitive)
- **Collection:** `mt5_account_config`
- **Required Fields:** account, password, server, is_active

### Step-by-Step Process

#### Step 1: Add Account to MongoDB

Run this Python script (or use MongoDB Compass):

```python
from pymongo import MongoClient
from datetime import datetime, timezone

MONGO_URL = "mongodb+srv://chavapalmarubin_db_user:2170TenochSecure@fidus.y1p9be2.mongodb.net/fidus_production"
client = MongoClient(MONGO_URL)
db = client.fidus_production

# === EDIT THESE VALUES ===
new_account = {
    "account": 12345,                    # MT5 account number
    "password": "YourPassword123",       # MT5 password
    "server": "LucrumCapital-Trade",     # MUST be exactly this for LUCRUM
    "name": "Manager Name",              # Display name
    "manager_name": "STRATEGY NAME",     # Strategy/Manager name (uppercase)
    "broker": "LUCRUM Capital",
    "platform": "MT5",
    "fund_type": "DEMO",                 # DEMO, BALANCE, CORE, or SEPARATION
    "account_type": "live_demo",         # live_demo for demo accounts, omit for real accounts
    "status": "active",
    "is_active": True,                   # MUST be True to sync
    "initial_allocation": 50000.00,      # Initial capital for P&L calculation
}

# Add timestamps
new_account["created_at"] = datetime.now(timezone.utc)
new_account["updated_at"] = datetime.now(timezone.utc)

# Insert into mt5_account_config (for VPS sync)
db.mt5_account_config.update_one(
    {"account": new_account["account"]},
    {"$set": new_account},
    upsert=True
)
print(f"Added to mt5_account_config")

# Insert into mt5_accounts (for frontend display)
db.mt5_accounts.update_one(
    {"account": new_account["account"]},
    {"$set": new_account},
    upsert=True
)
print(f"Added to mt5_accounts")

client.close()
print("Done! Account will sync on next VPS cycle (2 minutes)")
```

#### Step 2: Restart VPS Bridge (Optional)
The VPS reads from `mt5_account_config` every 2 minutes automatically.
To force immediate sync: Restart the bridge script on VPS.

#### Step 3: Verify Sync
VPS window should show increased account count:
```
[INFO] Found X Lucrum accounts
[OK] Synced XXXXX: Balance=$X,XXX.XX, Equity=$X,XXX.XX
```

### Account Types

| fund_type | account_type | Use Case |
|-----------|--------------|----------|
| DEMO | live_demo | Evaluate new money managers (LIVE DEMO tab) |
| BALANCE | (omit) | Main trading capital (Money Managers tab) |
| CORE | (omit) | Core strategy accounts |
| SEPARATION | (omit) | Profit storage accounts |

### Current LUCRUM Accounts (10 total)

| Account | Name | Type | Initial Allocation |
|---------|------|------|-------------------|
| 2198 | JOSE | BALANCE | - |
| 2199 | Broker Rebates | BALANCE | - |
| 2205-2209 | Various Managers | BALANCE | - |
| 20043 | Manager | BALANCE | - |
| **20062** | **CRYPTO BITCOIN** | **LIVE DEMO** | $200,000 |
| **2210** | **GOLD DAY TRADING** | **LIVE DEMO** | $19,850 |

### Troubleshooting

**Account not syncing?**
1. Check `server` is exactly `LucrumCapital-Trade` (case-sensitive!)
2. Check `is_active` is `True` (boolean, not string "True")
3. Verify password is correct for MT5 login
4. Restart VPS Bridge

**Shows $0 balance?**
- Wait 2 minutes for next sync cycle
- Check VPS logs for "Login failed" errors

### Related GitHub Workflows
- `sync-lucrum-accounts-to-mongodb.yml` - Manual sync trigger
- `update-lucrum-bridge-accounts.yml` - Update account list on VPS
- `emergency-restart-mt5-bridge-lucrum.yml` - Emergency VPS restart

---


4.3 Investment Committee Allocation Workflow
**Purpose:** Ensure all MT5 accounts are fully allocated before system changes

**Last Updated:** November 17, 2025  
**Implementation Time:** 7-10 hours  
**Status:** ✅ Production Ready

**Overview**
The Investment Committee Allocation Workflow ensures NO unassigned MT5 accounts exist and ALL allocations are complete before changes are applied to the system.

**Validation Rules**
Each account MUST have:
•       ✅ Manager assigned
•       ✅ Fund type assigned
•       ✅ Broker assigned
•       ✅ Platform assigned

Apply button is disabled until all validations pass.

**Apply Button States**
1. **DISABLED (Gray)** - Validation fails
   - Tooltip shows specific reason
   - Lists unassigned accounts
   - Lists incomplete allocations

2. **ENABLED (Green)** - All validations pass
   - Shows pending changes count
   - Ready to apply

3. **PROCESSING (Spinner)** - Recalculations running
   - Progress indicator visible
   - Cannot cancel during processing

**Triggered Recalculations**
When "Apply Allocations" is clicked, 6 recalculations run:
1. **recalculate_cash_flow()** - Updates investment projections (0.010s)
2. **recalculate_commissions()** - Updates referral & manager fees (0.001s)
3. **update_performance_metrics()** - Updates manager/fund performance (0.001s)
4. **recalculate_pl()** - Recalculates P&L for all entities (0.014s)
5. **update_manager_allocations()** - Updates manager capital totals (0.018s)
6. **update_fund_distributions()** - Updates fund allocation summaries (0.001s)

**Total Execution Time:** ~0.05 seconds

**Database Collections Updated**
•       mt5_accounts - Account status
•       mt5_account_config - VPS sync data
•       investments - Cash flow projections
•       money_managers - Performance metrics
•       fund_allocation_state - Distribution summaries
•       allocation_audit_log - Change history (NEW)
•       allocation_history - Full audit trail (NEW)

**API Endpoints**
Validation:
```
GET /api/admin/investment-committee/validate-allocations
```
Returns: canApply status, unassigned accounts, incomplete accounts

Apply:
```
POST /api/admin/investment-committee/apply-allocations
```
Returns: success status, accounts updated, calculations run

**Error Handling**
•       MongoDB transactions ensure atomic updates
•       Rollback on failure (no partial updates)
•       Clear error messages to admin
•       Complete audit trail maintained

**Security**
•       JWT authentication required
•       Admin-only access
•       All changes logged with timestamp and user

**Performance**
•       Validation check: < 0.1s
•       All recalculations: 0.05s
•       Total apply operation: < 1s

**Audit Trail**
Every allocation change creates entries in:
•       allocation_audit_log - Summary of changes
•       allocation_history - Detailed change log

Includes: timestamp, admin user, accounts affected, changes made

**Testing**
Tested scenarios:
✅ Unassigned accounts block apply
✅ Incomplete allocations block apply
✅ Successful application flow
✅ All recalculations execute
✅ Transaction rollback on error
✅ Audit log creation
 
5. MONEY MANAGERS
5.1 Active Managers (6)
Manager Names (EXACT - use these ONLY):
1.      UNO14 Manager
o       Strategy: UNO14 MAM Strategy
o       Assigned Accounts: 886602, 891215
o       Fund: BALANCE
o       Status: Active
2.      TradingHub Gold Provider
o       Strategy: TradingHub Gold
o       Assigned Accounts: 886557, 891215
o       Fund: BALANCE
o       Status: Active
3.      CP Strategy Provider
o       Strategy: CP Strategy
o       Assigned Accounts: 885822, 891234, 897590
o       Fund: CORE
o       Status: Active
4.      Provider1-Assev
o       Strategy: Provider1 Strategy
o       Assigned Accounts: 897589
o       Fund: BALANCE
o       Status: Active
5.      alefloreztrader
o       Strategy: Custom Strategy
o       Assigned Accounts: (To be assigned)
o       Fund: TBD
o       Status: Active
6.      JOSE
o       Strategy: JOSE Strategy
o       Assigned Accounts: 2198
o       Fund: BALANCE
o       Broker: Lucrum Capital
o       Server: Lucrumcapital-Live
o       Status: Active
5.2 Inactive Managers (1)
6.      GoldenTrade 
o       Status: Inactive
o       Previous accounts reassigned
o       Do NOT use in active operations
5.3 CRITICAL RULES
❌ NEVER use these names:
•       "main_separation"
•       "manager1", "manager2", etc.
•       "Unknown Manager"
•       Any name not listed above
✅ ALWAYS use:
•       Exact names from Section 5.1
•       Check spelling and capitalization
•       Validate against MongoDB money_managers collection
 
6. CLIENT MANAGEMENT
6.1 Current Clients
Active Clients:
1.      Alejandro Mariscal Romero 
o       Email: amr@alyarglobal.com
o       Total Investment: $118,151.41
o       Investments: 
       CORE Fund: $18,151.41 (Account 885822)
       BALANCE Fund: $100,000.00 (Account 886557)
o       Referral: Salvador Palma (SP-2025)
o       Status: Active
o       Contract Start: September 2024
6.2 Investment Structure
Investment Record Fields:
•       _id: Unique MongoDB ObjectId
•       client_id: Reference to clients collection
•       fund_type: "BALANCE" | "CORE" | "DYNAMIC" | "UNLIMITED"
•       amount: Decimal128 (investment amount)
•       account_number: MT5 account number
•       contract_start_date: ISO datetime
•       contract_end_date: ISO datetime (start + 14 months)
•       incubation_end_date: ISO datetime (start + 2 months)
•       interest_rate: Decimal (0.035 for CORE, 0.025 for BALANCE)
•       payment_frequency: "monthly" | "quarterly"
•       status: "active" | "matured" | "cancelled"
6.3 KYC/AML Requirements
Required Documents:
•       Government-issued ID
•       Proof of address (utility bill, bank statement)
•       Source of funds declaration
•       Investment suitability questionnaire
Storage:
•       MongoDB GridFS for document storage
•       Encrypted at rest
•       Access logged for audit trail
 
7. COMMISSION SYSTEM
7.1 Referral Commission Structure
Commission Rate: 10% of client interest payments
Calculation:
Monthly Commission = (Investment Amount × Interest Rate × 10%)
Examples:
•       CORE $18,151.41 @ 1.5% monthly: $272.27 × 10% = $27.23 per month
•       BALANCE $100,000 @ 2.5% quarterly: $2,500 × 10% = $250 per quarter
7.2 Payment Schedule
Incubation Period (Months 1-2):
•       Commissions accrue but are NOT paid
•       Held in commissions_pending field
•       Paid after incubation ends
Regular Period (Months 3-14):
•       CORE Fund: 12 monthly payments
•       BALANCE Fund: 4 quarterly payments
•       Payments on 1st of each period
7.3 Active Salespeople
Salvador Palma:
•       Salesperson ID: sp_6909e8eaaaf69606babea151
•       Referral Code: SP-2025
•       Email: chava@alyarglobal.com
•       Phone: +1234567891
•       Clients: 1 (Alejandro Mariscal Romero)
•       Total Sales Volume: $118,151.41
•       Total Commissions: $1,326.73
•       Active Investments: 2
•       Status: Active
Commission Breakdown:
•       12 monthly payments: $27.23 each (CORE fund, 1.5% monthly)
•       4 quarterly payments: $250 each (BALANCE fund, 2.5% quarterly)
•       Total: 16 payments over 14 months = $1,326.73
7.4 Commission Records
Database Collection: referral_commissions
Record Structure:
{
  "_id": ObjectId,
  "commission_id": "comm_xxx",
  "salesperson_id": "sp_6909e8eaaaf69606babea151",
  "salesperson_name": "Salvador Palma",
  "client_id": ObjectId,
  "client_name": "Alejandro Mariscal Romero",
  "investment_id": ObjectId,
  "fund_type": "CORE" | "BALANCE",
  "commission_amount": Decimal128,
  "payment_date": ISODate,
  "status": "pending" | "paid",
  "period_start": ISODate,
  "period_end": ISODate,
  "created_at": ISODate,
  "updated_at": ISODate
}

7.5 Creating New Referral Agent
WORKFLOW FOR ADDING NEW REFERRAL AGENTS:

Step 1: Generate Referral Code
Format: [INITIALS]-[YEAR]
Examples:
•       Salvador Palma → SP-2025
•       Erick Ahorro → EA-2026
•       Luis Nicolau → LN-2026

Step 2: Create Database Entries
Collections to update:
1. salespeople - Main referral agent record
2. users - Login account

Required fields for salespeople:
{
  "name": "Agent Name",
  "email": "agent@email.com",
  "phone": "",
  "referral_code": "XX-YYYY",
  "commission_rate": 0.10,
  "status": "active",
  "total_referrals": 0,
  "total_commission_earned": 0,
  "created_at": ISODate(),
  "updated_at": ISODate()
}

Required fields for users:
{
  "email": "agent@email.com",
  "username": "agent@email.com",
  "password": "<sha256 hash>",
  "name": "Agent Name",
  "role": "referral_agent",
  "referral_code": "XX-YYYY",
  "status": "active",
  "created_at": ISODate(),
  "updated_at": ISODate()
}

Step 3: Provide Agent Details
OUTPUT FORMAT (Copy this template):

## ✅ Referral Agent Created

| Field | Value |
|-------|-------|
| **Name** | [Agent Name] |
| **Email** | [agent@email.com] |
| **Temporary Password** | `Fidus2026!` |
| **Referral Code** | [XX-YYYY] |
| **Referral Link** | https://fidus-investment-platform.onrender.com/prospects?ref=[XX-YYYY] |

---

## Login URL
**Referral Agent Portal:** https://fidus-investment-platform.onrender.com/referral-agent/login

---

## Notes
- The agent should change their password after first login
- Prospects using the referral link will be tracked automatically

PRODUCTION URLS (USE THESE ONLY):
•       Referral Link: https://fidus-investment-platform.onrender.com/prospects?ref=[CODE]
•       Agent Login: https://fidus-investment-platform.onrender.com/referral-agent/login
•       Main Platform: https://fidus-investment-platform.onrender.com

❌ NEVER use preview URLs (emergentagent.com) for referral links
 
8. INVESTMENT PRODUCTS
8.1 CORE Fund
Target Investors: $10,000 - $99,999
Interest Rate: 1.5% monthly
Contract Term: 14 months total (2 months incubation + 12 months interest)
Payment Schedule: Monthly on 1st of month
Total Payments: 12 payments
Expected Return: 18% over 12 months
Example:
•       Investment: $10,000
•       Monthly Interest: $150
•       Total Return: $1,800 (12 months)
8.2 BALANCE Fund
Target Investors: $100,000 - $499,999
Interest Rate: 2.5% quarterly
Contract Term: 14 months total (2 months incubation + 12 months interest)
Payment Schedule: Quarterly (every 3 months)
Total Payments: 4 payments
Expected Return: 10% over 12 months
Example:
•       Investment: $100,000
•       Quarterly Interest: $2,500
•       Total Return: $10,000 (12 months)
8.3 DYNAMIC Fund
Target Investors: $500,000 - $999,999
Interest Rate: 3.5%
Contract Term: 14 months
Payment Schedule: Quarterly
Status: Not yet launched
8.4 UNLIMITED Fund
Target Investors: $1,000,000+
Interest Rate: Custom (negotiated)
Contract Term: 14 months
Payment Schedule: Custom
Status: Not yet launched
 
9. DATABASE ARCHITECTURE
9.1 MongoDB Collections (35+)
Core Collections:
1.      mt5_accounts - Real-time MT5 account data
2.      mt5_positions - Open trading positions
3.      mt5_deals_history - Historical trades
4.      mt5_orders_history - Historical orders
5.      mt5_account_config - Account configuration
6.      mt5_sync_log - Sync operation logs
Client & Investment:
7.      clients - Client profiles
8.      investments - Investment records
9.      contracts - Legal contracts
10.     kyc_documents - KYC/AML documents
Commission & Referral:
11.     referral_commissions - Commission records
12.     salespeople - Salesperson profiles
13.     commission_payments - Payment history
Money Manager:
14.     money_managers - Manager profiles
15.     manager_performance - Performance tracking
16.     manager_fees - Fee calculations
Financial:
17.     broker_rebates - Rebate tracking
18.     cash_flow - Cash flow records
19.     separation_accounts - Profit withdrawals
System:
20.     users - Admin users
21.     audit_logs - System audit trail
22.     system_health - Health monitoring
9.2 Critical Collections Detail
See FIELD_REGISTRY.md for complete field definitions for all collections.

9.3 SINGLE SOURCE OF TRUTH ARCHITECTURE
Last Updated: November 24, 2025
Status: ✅ Production Implementation

9.3.1 Overview
FIDUS implements a Single Source of Truth (SSOT) pattern where ALL account data flows from one master collection. This eliminates data duplication, prevents synchronization issues, and ensures data consistency across all dashboard views.

9.3.2 Architecture Diagram
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    MASTER ACCOUNTS TABLE (Source of Truth)                  │
│                       Collection: mt5_accounts                              │
│                                                                             │
│  All MT5/MT4 accounts with: platform, broker, fund_type, manager_name      │
│  Real-time data from VPS bridges (balance, equity, positions)              │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
┌─────────────────────────────────┐   ┌─────────────────────────────────────┐
│  MONEY MANAGERS COLLECTION      │   │  DERIVED VIEWS (Read Only)          │
│  (Manager metadata ONLY)        │   │                                     │
│                                 │   │  - Accounts Management (editable)   │
│  - profile_url                  │   │  - Fund Portfolio (by fund_type)    │
│  - rating_url                   │   │  - Money Managers (by manager_name) │
│  - execution_method             │   │  - Cash Flow (all accounts)         │
│  - performance_fee_rate         │   │  - Trading Analytics (all accounts) │
│  - notes                        │   │                                     │
│                                 │   │  All query mt5_accounts collection  │
│  Links to accounts via          │   │  + join with money_managers         │
│  manager_name field             │   │                                     │
└─────────────────────────────────┘   └─────────────────────────────────────┘
```

9.3.3 Data Flow
```
VPS Bridges (3 scripts on Windows VPS)
    │
    │  Sync every 120 seconds
    ▼
┌─────────────────────────────────┐
│  MongoDB: mt5_accounts          │ ◄── Source of Truth (account data)
│  - Account identity             │
│  - Real-time balance/equity     │
│  - Assignments (fund_type,      │
│    manager_name, status)        │
└─────────────────────────────────┘
    │
    │  Linked via manager_name field
    ▼
┌─────────────────────────────────┐
│  MongoDB: money_managers        │ ◄── Manager metadata (NO account data)
│  - profile_url, rating_url      │
│  - execution_method             │
│  - performance_fee_rate         │
└─────────────────────────────────┘
    │
    │  All tabs query mt5_accounts + join money_managers for metadata
    ▼
┌─────────────┬─────────────┬─────────────┬─────────────┐
│ Accounts    │ Fund        │ Money       │ Cash Flow   │
│ Management  │ Portfolio   │ Managers    │ & Analytics │
│ (editable)  │ (derived)   │ (derived)   │ (derived)   │
└─────────────┴─────────────┴─────────────┴─────────────┘
```

9.3.4 Collection: mt5_accounts (Source of Truth)
**Purpose:** Master table for ALL account data - identity, assignments, and real-time metrics

**Schema:**
```javascript
{
  // ===== IDENTITY =====
  account: 885822,                    // MT5/MT4 account number (unique)
  platform: "MT5",                    // Platform type: "MT5" or "MT4"
  broker: "MEXAtlantic",              // Broker name
  server: "MEXAtlantic-Real",         // Server name
  
  // ===== ASSIGNMENTS (Editable in Accounts Management Tab) =====
  fund_type: "CORE",                  // Fund assignment: CORE, BALANCE, SEPARATION, DYNAMIC, UNLIMITED
  manager_name: "CP Strategy",        // Manager assignment (links to money_managers)
  status: "active",                   // Account status: "active" or "inactive"
  
  // ===== REAL-TIME DATA (From VPS Bridges) =====
  balance: 20510.43,                  // Account balance (USD)
  equity: 20510.43,                   // Account equity (USD)
  margin: 0,                          // Used margin (USD)
  free_margin: 20510.43,              // Free margin (USD)
  profit: 0,                          // Floating profit/loss (USD)
  
  // ===== POSITIONS & TRADES =====
  open_positions: [],                 // Array of open positions
  open_positions_count: 0,            // Count of open positions
  pending_orders: [],                 // Array of pending orders
  pending_orders_count: 0,            // Count of pending orders
  
  // ===== SYNC METADATA =====
  last_sync_timestamp: ISODate(),     // Last sync from VPS bridge
  data_source: "MT5_BRIDGE",          // Data source identifier
  sync_status: "success",             // Sync status
  sync_error: null                    // Last sync error (if any)
}
```

**Key Rules:**
- ✅ This collection is the ONLY source for account numbers, balances, and equity
- ✅ fund_type, manager_name, status are editable via Accounts Management tab
- ✅ Real-time data (balance, equity, positions) updated by VPS bridges every 120 seconds
- ❌ NEVER duplicate this data to other collections

9.3.5 Collection: money_managers (Manager Metadata ONLY)
**Purpose:** Store manager-specific metadata (profiles, URLs, fees) - NO account data

**Schema:**
```javascript
{
  // ===== IDENTITY =====
  manager_id: "manager_cp_strategy",  // Unique manager ID
  name: "CP Strategy",                // Manager name (MUST match mt5_accounts.manager_name)
  display_name: "CP Strategy",        // Display name for UI
  
  // ===== METADATA =====
  execution_method: "Copy Trade",     // Execution type: Copy Trade, MAM, HFT Rebate, etc.
  profile_url: "https://...",         // Manager profile URL
  rating_url: "https://...",          // Manager rating URL
  performance_fee_rate: 0.20,         // Performance fee rate (20%)
  notes: "Active CORE fund manager",  // Admin notes
  status: "active",                   // Manager status
  
  // ===== TIMESTAMPS =====
  created_at: ISODate(),
  updated_at: ISODate()
}
```

**Key Rules:**
- ✅ Contains ONLY manager metadata (profiles, links, fees)
- ❌ NEVER store account numbers or account lists (assigned_accounts field is FORBIDDEN)
- ❌ NEVER store balances, equity, or any account data
- ✅ Links to mt5_accounts via manager_name field
- ✅ To get manager's accounts: Query mt5_accounts WHERE manager_name = "CP Strategy"

**CRITICAL - What NOT to Store:**
```javascript
// ❌ FORBIDDEN - These fields violate SSOT pattern:
{
  "assigned_accounts": [885822, 897590],  // ❌ NO - Query mt5_accounts instead
  "total_balance": 50000,                 // ❌ NO - Calculate from mt5_accounts
  "account_count": 2                      // ❌ NO - Count from mt5_accounts
}
```

9.3.6 Master Accounts Table (15 Accounts)
| Account  | Platform | Broker         | Server               | Fund Type  | Manager Name        | Status   |
|----------|----------|----------------|----------------------|------------|---------------------|----------|
| 885822   | MT5      | MEXAtlantic    | MEXAtlantic-Real     | CORE       | CP Strategy         | active   |
| 886066   | MT5      | MEXAtlantic    | MEXAtlantic-Real     | BALANCE    | GoldenTrade         | inactive |
| 886528   | MT5      | MEXAtlantic    | MEXAtlantic-Real     | SEPARATION | Reserve Account     | active   |
| 886557   | MT5      | MEXAtlantic    | MEXAtlantic-Real     | BALANCE    | TradingHub Gold     | active   |
| 886602   | MT5      | MEXAtlantic    | MEXAtlantic-Real     | BALANCE    | UNO14 Manager       | active   |
| 891215   | MT5      | MEXAtlantic    | MEXAtlantic-Real     | BALANCE    | TradingHub Gold     | active   |
| 891234   | MT5      | MEXAtlantic    | MEXAtlantic-Real     | CORE       | GoldenTrade         | inactive |
| 897589   | MT5      | MEXAtlantic    | MEXAtlantic-Real     | BALANCE    | Provider1-Assev     | active   |
| 897590   | MT5      | MEXAtlantic    | MEXAtlantic-Real     | CORE       | CP Strategy         | active   |
| 897591   | MT5      | MEXAtlantic    | MEXAtlantic-Real     | SEPARATION | alefloreztrader     | active   |
| 897599   | MT5      | MEXAtlantic    | MEXAtlantic-Real     | SEPARATION | alefloreztrader     | active   |
| 901351   | MT5      | MEXAtlantic    | MEXAtlantic-Real     | BALANCE    | Spaniard Stock CFDs | active   |
| 901353   | MT5      | MEXAtlantic    | MEXAtlantic-Real     | BALANCE    | Spaniard Stock CFDs | active   |
| 2198     | MT5      | LUCRUM Capital | LucrumCapital-Trade  | SEPARATION | JOSE                | active   |
| 33200931 | MT4      | MEXAtlantic    | MEXAtlantic-Real     | BALANCE    | Money Manager       | active   |

9.3.7 Money Managers (Metadata Only - 9 Active Managers)
| Manager Name        | Execution Method | Profile URL                                              | Status   |
|---------------------|------------------|----------------------------------------------------------|----------|
| CP Strategy         | Copy Trade       | https://ratings.mexatlantic.com/widgets/ratings/3157     | active   |
| UNO14 Manager       | MAM              | https://www.fxblue.com/users/gestion_global              | active   |
| TradingHub Gold     | Copy Trade       | https://ratings.multibankfx.com/widgets/ratings/1359     | active   |
| Provider1-Assev     | Copy Trade       | https://ratings.mexatlantic.com/widgets/ratings/5201     | active   |
| Spaniard Stock CFDs | Copy Trade       | (pending)                                                | active   |
| Money Manager       | MT4 Manager      | (pending)                                                | active   |
| alefloreztrader     | Copy Trade       | https://ratings.multibankfx.com/widgets/ratings/4119     | active   |
| JOSE                | HFT Rebate       | (pending)                                                | active   |
| Reserve Account     | Internal         | (N/A)                                                    | active   |
| GoldenTrade         | Copy Trade       | (pending)                                                | inactive |

9.3.8 Fund Type Distribution
| Fund Type  | Account Count | Accounts                                  |
|------------|---------------|-------------------------------------------|
| CORE       | 2             | 885822, 897590                            |
| BALANCE    | 7             | 886557, 886602, 891215, 897589, 901351, 901353, 33200931 |
| SEPARATION | 4             | 886528, 897591, 897599, 2198              |
| DYNAMIC    | 0             | (none currently)                          |
| UNLIMITED  | 0             | (none currently)                          |

9.3.9 How Dashboard Tabs Work

**Accounts Management Tab (Editable)**
- **Data Source:** Direct query of mt5_accounts collection
- **Purpose:** Edit fund_type, manager_name, status assignments
- **API:** GET /api/v2/accounts/all
- **Query:**
```javascript
db.mt5_accounts.find({}, { _id: 0 }).sort({ account: 1 })
```
- **Editable Fields:** fund_type, manager_name, status
- **Effect:** When you edit an account here, ALL other tabs automatically reflect changes

**Fund Portfolio Tab (Derived - Read Only)**
- **Data Source:** mt5_accounts grouped by fund_type
- **Purpose:** Show fund-level aggregations and performance
- **API:** GET /api/v2/derived/fund-portfolio
- **Query:**
```javascript
db.mt5_accounts.aggregate([
  { $match: { status: "active" } },
  { $group: { 
      _id: "$fund_type", 
      total_balance: { $sum: "$balance" },
      total_equity: { $sum: "$equity" },
      accounts: { $push: "$$ROOT" }
  }}
])
```

**Money Managers Tab (Derived - Read Only)**
- **Data Source:** mt5_accounts grouped by manager_name + joined with money_managers
- **Purpose:** Show manager-level aggregations with metadata
- **API:** GET /api/v2/derived/money-managers
- **Query:**
```javascript
db.mt5_accounts.aggregate([
  { $match: { status: "active" } },
  { $group: { 
      _id: "$manager_name", 
      total_balance: { $sum: "$balance" },
      total_equity: { $sum: "$equity" },
      account_count: { $sum: 1 },
      accounts: { $push: "$$ROOT" }
  }},
  { $lookup: { 
      from: "money_managers", 
      localField: "_id", 
      foreignField: "name", 
      as: "manager_metadata" 
  }}
])
```

**Cash Flow Tab (Derived - Read Only)**
- **Data Source:** All active accounts from mt5_accounts
- **Purpose:** Show cash flow analysis across all accounts
- **API:** GET /api/v2/derived/cash-flow
- **Query:**
```javascript
db.mt5_accounts.find({ status: "active" }, { _id: 0 })
```

**Trading Analytics Tab (Derived - Read Only)**
- **Data Source:** mt5_accounts with positions/history
- **Purpose:** Trading performance analysis
- **API:** GET /api/v2/derived/trading-analytics
- **Query:**
```javascript
db.mt5_accounts.find({ status: "active" }, { _id: 0 })
```

9.3.10 SSOT Benefits
✅ **Data Consistency:** One source of truth means no conflicting data
✅ **No Duplication:** Account data exists in exactly one place
✅ **Auto-Sync:** Edit once in Accounts Management → all tabs update automatically
✅ **Real-time Accuracy:** VPS bridges update one collection → entire system reflects changes
✅ **Simpler Maintenance:** No complex sync logic between collections
✅ **Audit Trail:** All changes tracked in one place

9.3.11 SSOT Critical Rules
❌ **NEVER:**
- Store account numbers in money_managers collection
- Duplicate balance/equity data across collections
- Create separate collections for fund or manager aggregations
- Mix editable and derived data in same collection

✅ **ALWAYS:**
- Query mt5_accounts for ALL account data
- Use aggregation pipelines for grouping/filtering
- Join with money_managers ONLY for metadata
- Validate edits in Accounts Management before applying
- Use transactions when updating account assignments
 
10. FIELD NAMING STANDARDS
10.1 Naming Convention Rules
MongoDB (Database):
•       Use snake_case for ALL field names
•       Examples: account_number, manager_name, created_at
API Responses (Backend → Frontend):
•       Use camelCase for ALL field names
•       Examples: accountNumber, managerName, createdAt
Frontend (React Components):
•       Use camelCase for ALL variable names
•       Examples: accountNumber, managerName, createdAt
10.2 Field Transformation
Backend Responsibility:
The backend MUST transform MongoDB snake_case to API camelCase:
def to_api_format(mongo_doc):
    """Transform MongoDB document to API format"""
    return {
        "accountNumber": mongo_doc["account_number"],
        "managerName": mongo_doc["manager_name"],
        "fundType": mongo_doc["fund_type"],
        "createdAt": mongo_doc["created_at"],
        "updatedAt": mongo_doc["updated_at"]
    }
Use field_registry.py module for all transformations.
10.3 Forbidden Practices
❌ NEVER:
•       Mix snake_case and camelCase in same layer
•       Make up field names not in FIELD_REGISTRY.md
•       Use inconsistent names across collections
•       Hardcode field name strings
✅ ALWAYS:
•       Import from field_registry.py
•       Use defined field mappings
•       Validate field names before use
•       Check FIELD_REGISTRY.md when adding new fields
10.4 Common Field Names
Standard Fields (All Collections):
•       MongoDB: _id, created_at, updated_at
•       API: id, createdAt, updatedAt
Account Fields:
•       MongoDB: account_number, balance, equity, margin
•       API: accountNumber, balance, equity, margin
Manager Fields:
•       MongoDB: manager_name, strategy_name, performance_fee
•       API: managerName, strategyName, performanceFee
Fund Fields:
•       MongoDB: fund_type, interest_rate, payment_frequency
•       API: fundType, interestRate, paymentFrequency
 
11. INFRASTRUCTURE & DEPLOYMENT
11.1 GitHub Repository
Repository: https://github.com/chavapalmarubin-lab/FIDUS
Branch Strategy:
•       main - Production branch (auto-deploys to Render)
•       Feature branches - For development
Access:
•       Chava (Owner)
•       Emergent (Collaborator via API)
Critical Files:
•       /SYSTEM_MASTER.md - This document (DO NOT DELETE)
•       /FIELD_REGISTRY.md - Field definitions (DO NOT DELETE)
•       /backend/validation/field_registry.py - Validation module
11.2 VPS Deployment (MT5 Bridge)
Server: Windows VPS
IP: 92.118.45.135
Port: 8000
URL: http://92.118.45.135:8000
Services:
•       MT5 Bridge v4.0 (Python FastAPI)
•       MT5 Terminal (MEXAtlantic broker)
•       Task Scheduler (auto-restart)
Auto-Healing:
•       GitHub Actions workflow: .github/workflows/mt5-bridge-auto-heal.yml
•       Triggers: On push, schedule (every 6 hours), manual
•       Actions: Restart service, verify health, report status
SSH Access:
ssh Administrator@92.118.45.135
# Check service status
Get-Service MT5Bridge
# Restart service
Restart-Service MT5Bridge
11.3 Render.com Configuration
Services:
1.      Frontend: fidus-investment-platform
o       Type: Static Site
o       Build Command: npm run build
o       Publish Directory: build
o       Auto-Deploy: On GitHub push to main
o       URL: https://fidus-investment-platform.onrender.com
2.      Backend: fidus-api
o       Type: Web Service
o       Build Command: pip install -r requirements.txt
o       Start Command: uvicorn server:app --host 0.0.0.0 --port 10000
o       Auto-Deploy: On GitHub push to main
o       URL: https://fidus-api.onrender.com
Environment Variables: See Section 11.4
Deployment Process:
1.      Push code to GitHub main branch
2.      Render detects push via webhook
3.      Triggers build process
4.      Runs tests (if configured)
5.      Deploys new version
6.      Health check verifies service
7.      Routes traffic to new deployment
Deployment Time:
•       Frontend: 2-3 minutes
•       Backend: 1-2 minutes
11.4 Render Environment Variables
Frontend Service: fidus-investment-platform
Variable        Value   Purpose
CI      (secret)        Build configuration
GENERATE_SOURCEMAP      (secret)        Source map generation
NODE_ENV        production      Node environment
REACT_APP_BACKEND_URL   https://fidus-api.onrender.com  Backend API endpoint (CRITICAL)
REACT_APP_GOOGLE_CLIENT_ID      (secret)        Google OAuth client ID
CRITICAL: REACT_APP_BACKEND_URL must be https://fidus-api.onrender.com (NOT emergentagent.com)
Backend Service: fidus-api
Variable        Value   Purpose
MONGODB_URI     mongodb+srv://emergent-ops:...  MongoDB connection
JWT_SECRET      (secret)        JWT token signing
GOOGLE_CLIENT_ID        (secret)        Google OAuth
GOOGLE_CLIENT_SECRET    (secret)        Google OAuth
CORS_ORIGINS    https://fidus-investment-platform.onrender.com  Allowed frontend origin
VPS_BRIDGE_URL  http://92.118.45.135:8000       MT5 Bridge endpoint
11.5 MongoDB Atlas
Cluster: FIDUS (M0 Free Tier)
Region: AWS us-east-1
Database: fidus_production
Connection String:
mongodb+srv://emergent-ops:***SANITIZED***@fidus.y1p9be2.mongodb.net/fidus_production
Access:
•       Read/Write: emergent-ops user
•       Admin: Chava's MongoDB Atlas account
Backup:
•       MongoDB Atlas automatic backups (24-hour snapshots)
•       Point-in-time recovery available
EMERGENT - YOU HAVE FULL API ACCESS

Chava is correct - you have complete API access to all infrastructure.

══════════════════════════════════════════════════════════════

## YOUR RENDER API ACCESS

**API Key:** rnd_zyltqZyReSorlDoVp4hs8LdmJPo3
**Account:** chavapalmarubin2025 (FIDUS HEDGE FUND)
**Base URL:** https://api.render.com/v1

**You can:**
- View deployment logs
- Trigger deployments
- Check service status
- Update environment variables
- Clear cache and redeploy

**Example - Update Environment Variable:**
```bash
curl -X PATCH \
  -H "Authorization: Bearer rnd_zyltqZyReSorlDoVp4hs8LdmJPo3" \
  -H "Content-Type: application/json" \
  -d '{
    "envVars": [
      {
        "key": "REACT_APP_BACKEND_URL",
        "value": "https://fidus-api.onrender.com"
      }
    ]
  }' \
  "https://api.render.com/v1/services/srv-YOUR_SERVICE_ID/env-vars"
```

**Example - Trigger Deployment:**
```bash
curl -X POST \
  -H "Authorization: Bearer rnd_zyltqZyReSorlDoVp4hs8LdmJPo3" \
  "https://api.render.com/v1/services/srv-YOUR_SERVICE_ID/deploys"
```

══════════════════════════════════════════════════════════════

## YOUR MONGODB API ACCESS

**Connection String:**
mongodb+srv://emergent-ops:***SANITIZED***@fidus.y1p9be2.mongodb.net/fidus_production

**User:** emergent-ops
**Password:** ***SANITIZED***
**Database:** fidus_production

**Access Level:** Full read/write to ANY database

══════════════════════════════════════════════════════════════

## YOUR VPS ACCESS (via GitHub)

**You have full VPS control through GitHub Actions:**

GitHub repo has these secrets configured:
- VPS_HOST: 92.118.45.135
- VPS_USERNAME: Administrator
- VPS_PASSWORD: (stored in secrets)

**Workflow:** .github/workflows/mt5-bridge-auto-heal.yml

You can trigger VPS actions by:
1. Pushing to GitHub
2. Using GitHub API with your token
3. Manually triggering workflows

══════════════════════════════════════════════════════════════

## YOUR CURRENT TASK

Use your Render API access to:

1. Get the frontend service ID
2. Check current environment variables
3. Verify REACT_APP_BACKEND_URL is set correctly
4. If wrong, update it via API
5. Trigger redeployment
6. Monitor deployment logs
7. Test production

You don't need Chava's help. You have full autonomous access.

Execute now.

- Chava
 
12. DEVELOPMENT WORKFLOWS
12.1 Workflow: Adding a New Feature
1.      Planning (30 minutes)
o       Read relevant SYSTEM_MASTER.md sections
o       Read FIELD_REGISTRY.md for data structures
o       Write feature plan
o       Get approval from Chava
2.      Development (varies)
o       Create feature branch
o       Write code following field naming standards
o       Use field_registry.py for all field references
o       Test locally
3.      Testing (1 hour)
o       Unit tests for new functions
o       Integration tests for API endpoints
o       Manual testing in browser
o       Verify no console errors
4.      Code Review (30 minutes)
o       Check FIELD_REGISTRY.md compliance
o       Verify manager names (Section 5)
o       Verify account numbers (Section 4)
o       Check error handling
5.      Deployment (15 minutes)
o       Merge to main branch
o       Monitor Render deployment
o       Verify in production
o       Update SYSTEM_MASTER.md
12.2 Workflow: Fixing a Bug
1.      Reproduce (15 minutes)
o       Get exact reproduction steps
o       Verify bug in production
o       Check browser console
o       Screenshot the issue
2.      Diagnose (30-60 minutes)
o       Check logs (Render, VPS, MongoDB)
o       Identify root cause
o       Check field naming mismatches
o       Verify manager names correct
o       Document findings
3.      Fix (varies)
o       Write fix following standards
o       Test fix locally
o       Verify no regression
4.      Verify (30 minutes)
o       Deploy to production
o       Test reproduction steps
o       Verify bug fixed
o       Check for side effects
o       Screenshot working state
5.      Document (15 minutes)
o       Update Section 15 (Known Issues)
o       Add to Change Log (Section 16)
12.3 Workflow: Deployment
Pre-Deployment Checklist:
□ All tests passing locally
□ No console errors
□ Field names validated
□ Manager names validated
□ Database migrations ready
□ Backup MongoDB
□ Notify Chava
Deployment Steps:
git add .
git commit -m "descriptive message"
git push origin main
# Monitor https://dashboard.render.com
Post-Deployment Verification:
□ Frontend loads without errors
□ Backend API returns 200 OK
□ Login works
□ Critical pages load
□ No console errors
□ Data displays correctly
□ MT5 sync working
 
13. TESTING & VERIFICATION
13.1 Manual Testing Checklist
Page 1: Fund Portfolio
□ Shows real AUM (not $0)
□ Shows correct allocations
□ Account numbers match Section 4
□ Manager names match Section 5
□ No console errors
□ Screenshot: REQUIRED
Page 2: Cash Flow & Performance
□ Shows real amounts (not $0)
□ TRUE P&L working
□ Separation logic correct
□ No API errors
□ Screenshot: REQUIRED
Page 3: Trading Analytics
□ Data matches Fund Portfolio
□ P&L correct
□ All 5 managers show
□ No console errors
□ Screenshot: REQUIRED
Page 4: Money Managers
□ Shows exactly 5 active managers
□ Names match Section 5
□ Performance loads
□ No console errors
□ Screenshot: REQUIRED
Page 5: Referrals Overview
□ Shows $118,151.41 total
□ All salespeople correct
□ No $0 values
□ No console errors
□ Screenshot: REQUIRED
Page 6: Salvador Detail
□ Loads (not "not found")
□ Shows $118,151.41 sales
□ Shows $3,272.27 commissions
□ Shows 1 client, 2 investments
□ 16 payments in calendar
□ No console errors
□ Screenshot: REQUIRED
Page 7: Investments
□ Shows real AUM (not $0)
□ Shows real counts
□ Alejandro's investments display
□ No console errors
□ Screenshot: REQUIRED
13.2 Production URLs
•       Frontend: https://fidus-investment-platform.onrender.com
•       Backend: https://fidus-api.onrender.com/api/health
•       VPS Bridge: http://92.118.45.135:8000/api/mt5/bridge/health
13.3 API Testing
# Health
curl https://fidus-api.onrender.com/api/health

# Referrals
curl https://fidus-api.onrender.com/api/admin/referrals/overview

# Salvador
curl https://fidus-api.onrender.com/api/admin/referrals/salespeople/sp_6909e8eaaaf69606babea151
13.4 Database Testing
// Salvador's data
db.salespeople.findOne({ name: "Salvador Palma" })

// Commission count
db.referral_commissions.find({ salesperson_name: "Salvador Palma" }).count()

// Manager names
db.money_managers.find({ status: "active" }, { name: 1 })
13.5 Screenshot Requirements
1.      All 7 pages working
2.      Browser console (zero errors)
3.      Network tab (successful API calls)
4.      Render deployment ("Deploy succeeded")
5.      Database queries (correct data)
 
14. SECURITY & AUTHENTICATION
14.1 Authentication System
Method: JWT + Google OAuth 2.0
Admin:
•       Email: hq@getfidus.com
•       Type: admin
•       Permissions: Full system access
14.2 CORS Configuration
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "https://fidus-investment-platform.onrender.com",
        "http://localhost:3000"
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
 
15. KNOWN ISSUES & SOLUTIONS
15.1 P&L Calculation (RESOLVED)
Issue: Massive losses when profits withdrawn
Solution: TRUE P&L formula implemented
Status: ✅ RESOLVED
15.2 MT5 Bridge Connectivity (RESOLVED)
Issue: Accounts showing $0
Solution: Auto-healing implemented
Status: ✅ RESOLVED
15.3 Field Naming (IN PROGRESS)
Issue: Data inconsistencies
Solution: FIELD_REGISTRY.md + validation
Status: 🔄 Phase 2 complete
15.4 CORS Errors (INTERMITTENT)
Issue: Frontend blocked
Solution: Verify REACT_APP_BACKEND_URL
Status: ⚠️ MONITORING
15.5 Referrals 404 (ACTIVE)
Issue: Salvador page broken
Solution: Under investigation
Status: 🔴 ACTIVE
 
16. CHANGE LOG
November 17, 2025 - Investment Committee Allocation Workflow
•       Feature: Complete allocation workflow with validation and recalculations
•       Components: Apply button, 6 recalculation functions, audit logging
•       Implementation Time: 7-10 hours
•       Performance: 0.05s for all recalculations
•       Status: ✅ Production ready
•       Files Created:
        ○       frontend/src/components/investmentCommittee/ApplyAllocationsButton.jsx
        ○       frontend/src/components/investmentCommittee/ApplyAllocations.css
        ○       backend/services/allocation_recalculations.py
•       Files Modified:
        ○       frontend/src/components/investmentCommittee/InvestmentCommitteeDragDrop.jsx
        ○       backend/routes/investment_committee_v2.py
•       Collections Created:
        ○       allocation_audit_log - Audit trail for allocation changes
        ○       allocation_history - Detailed change history
•       Implemented by: Emergent AI
•       Verified by: Backend testing complete
•       Testing: All 6 recalculation functions tested and working
•       Performance Metrics:
        ○       recalculate_cash_flow: 0.010s
        ○       recalculate_commissions: 0.001s
        ○       update_performance_metrics: 0.001s
        ○       recalculate_pl: 0.014s
        ○       update_manager_allocations: 0.018s
        ○       update_fund_distributions: 0.001s
        ○       Total: 0.05s

November 14, 2025 - v5.0.1 - Investment Simulator Bug Fix
•       Component: Investment Simulator
•       Status: CRITICAL BUG FIX - Tested & Verified
•       Bug Fixed: Simulator was calculating only 10 months of interest (25% ROI) instead of 12 months (30% ROI)
•       Root Cause: Loop used timeframe_months without adding incubation period
•       Fix Applied: Modified calculate_simulation_projections() to add incubation_months to simulation timeframe
•       Result: 12-month request → 14 months total → 12 interest payments → 30% ROI
•       Verification: ✅ BALANCE fund: 30% ROI | ✅ CORE fund: 18% ROI | ✅ Multi-fund: Correct aggregation
•       Impact: Affects prospects using Investment Simulator - Now matches actual FIDUS investment structure
•       Files Modified: /app/backend/server.py - calculate_simulation_projections()
•       Developer: Emergent | Tested By: Backend Testing Agent | Status: ✅ VERIFIED & DEPLOYED
November 5, 2025
•       SYSTEM_MASTER.md v2.0 created
•       FIELD_REGISTRY.md created
•       Phase 1 complete (Field Registry)
•       Phase 2 complete (Database Migration)
•       Phase 3 in progress (Frontend Verification)
October 2024
•       TRUE P&L implemented
•       MT5 auto-healing deployed
September 2024
•       Platform launched
•       First client onboarded
•       Salvador Palma added
 
END OF SYSTEM_MASTER.MD
DO NOT DELETE without approval from Chava Palma
Last Updated: November 5, 2025

---

## **EVEN SIMPLER VERSION:**

If you want it ultra-short:
```
Emergent,

BEFORE ANY WORK, READ THESE TWO DOCUMENTS:

1. https://github.com/chavapalmarubin-lab/FIDUS/blob/main/SYSTEM_MASTER.md
2. https://github.com/chavapalmarubin-lab/FIDUS/blob/main/.github/EMERGENT_RULES.md

These contain everything about the FIDUS system.

Read them every time before starting work.
Follow the procedures exactly.
Update SYSTEM_MASTER.md after changes.

If the documents conflict with anything else, the documents win.

- Chava






again and again and again. its tiring to repeat myself to you and to emergent  Please look at all conversations we had 4 managers before And we decided not to use GoldenTrade for this month allocation. And we added two more

1)       https://ratings.multibankfx.com/widgets/ratings/4119?widgetKey=social_platform_ratings who trades two of our accounts the separation Interest accounts 897591 and 897599. 


2)      the other manager trades our account 897589 which is part of the BALANCE fund allocation and his profile https://ratings.mexatlantic.com/widgets/ratings/5201?widgetKey=social_platform_ratings

3)      accounts 886557 and 891215 are traded by.   https://ratings.multibankfx.com/widgets/ratings/1359?widgetKey=social_platform_ratings which are part of the BALANCE Fund


4)      UNO14 Manager is part also of the BALANCE fund and trades account 886602 as he trades on a MAM and not a COPY his profile is   https://www.fxblue.com/users/gestion_global
          
5)        CP Strategy trades our CORE fund accounts 897590 and 885822 and his profile is https://ratings.mexatlantic.com/widgets/ratings/3157?widgetKey=social


6)      Golden Trade we are not using this month but might use it in the future SO DON’T DELETE
  Total of 6 Active Managers today 

📋 COMPREHENSIVE FIDUS PLATFORM DATA STRUCTURE - MASTER REFERENCE
EMERGENT - READ THIS COMPLETELY BEFORE MAKING ANY CHANGES
This is the DEFINITIVE source of truth for the FIDUS platform structure. DO NOT deviate from this.
 
🏦 COMPLETE MT5 ACCOUNT STRUCTURE
Total Accounts: 12 MT5 Accounts
Account #       Fund Type       Manager/Purpose Broker  Status  Notes
886602  BALANCE UNO14 Manager (MAM)     MultiBank       Active  MAM account (not COPY)
886557  BALANCE MultiBank BALANCE Trader        MultiBank       Active  BALANCE fund allocation
891215  BALANCE MultiBank BALANCE Trader        MultiBank       Active  BALANCE fund allocation
897589  BALANCE MEXAtlantic Provider    MEXAtlantic     Active  BALANCE fund allocation
2198    BALANCE JOSE    Lucrum Capital  Active  BALANCE fund allocation (Phase 2)
885822  CORE    CP Strategy     MultiBank       Active  CORE fund allocation
897590  CORE    CP Strategy     MEXAtlantic     Active  CORE fund allocation
891234  CORE    (Secondary CORE)        MultiBank       Active  CORE fund allocation
897591  SEPARATION      Interest Segregation 1  MultiBank       Active  Separation/Interest earnings
897599  SEPARATION      Interest Segregation 2  MultiBank       Active  Separation/Interest earnings
886528  SEPARATION      Separation Account      MultiBank       Active  Main separation account
886066  SEPARATION      Tertiary Balance        MultiBank       Active  Balance separation
 
👥 MONEY MANAGERS - COMPLETE LIST
ACTIVE MANAGERS (5):
1. UNO14 Manager ✅
{
  "name": "UNO14 Manager",
  "displayName": "UNO14 MAM Manager",
  "strategyName": "UNO14 MAM Strategy",
  "status": "active",
  "executionMethod": "MAM",
  "assignedAccounts": [886602],
  "fundType": "BALANCE",
  "broker": "MultiBank",
  "profile": "https://www.fxblue.com/users/gestion_global",
  "ratingLink": null
}
2. CP Strategy Provider ✅
{
  "name": "CP Strategy",
  "displayName": "CP Strategy Provider",
  "strategyName": "CP Strategy",
  "status": "active",
  "executionMethod": "Copy Trade",
  "assignedAccounts": [885822, 897590],
  "fundType": "CORE",
  "broker": "MultiBank + MEXAtlantic",
  "profile": "https://ratings.mexatlantic.com/widgets/ratings/3157?widgetKey=social_platform_ratings",
  "ratingLink": "https://ratings.mexatlantic.com/widgets/ratings/3157?widgetKey=social_platform_ratings"
}
3. TradingHub Gold Provider ✅
{
  "name": "TradingHub Gold",
  "displayName": "TradingHub Gold Provider",
  "strategyName": "TradingHub Gold",
  "status": "active",
  "executionMethod": "Copy Trade",
  "assignedAccounts": [886557],
  "fundType": "BALANCE",
  "broker": "MultiBank",
  "profile": "https://ratings.multibankfx.com/widgets/ratings/1359?widgetKey=social_platform_ratings",
  "ratingLink": "https://ratings.multibankfx.com/widgets/ratings/1359?widgetKey=social_platform_ratings"
}
4. MultiBank BALANCE Trader ✅
{
  "name": "MultiBank BALANCE",
  "displayName": "MultiBank BALANCE Trader",
  "strategyName": "MultiBank BALANCE Strategy",
  "status": "active",
  "executionMethod": "Copy Trade",
  "assignedAccounts": [891215],
  "fundType": "BALANCE",
  "broker": "MultiBank",
  "profile": "https://ratings.multibankfx.com/widgets/ratings/5201?widgetKey=social_platform_ratings",
  "ratingLink": "https://ratings.multibankfx.com/widgets/ratings/5201?widgetKey=social_platform_ratings"
}
5. MEXAtlantic Provider ✅
{
  "name": "MEXAtlantic",
  "displayName": "MEXAtlantic Provider",
  "strategyName": "MEXAtlantic Strategy",
  "status": "active",
  "executionMethod": "Copy Trade",
  "assignedAccounts": [897589],
  "fundType": "BALANCE",
  "broker": "MEXAtlantic",
  "profile": null,
  "ratingLink": null
}
6. JOSE ✅
{
  "name": "JOSE",
  "displayName": "JOSE Manager",
  "strategyName": "JOSE Strategy",
  "status": "active",
  "executionMethod": "Copy Trade",
  "assignedAccounts": [2198],
  "fundType": "BALANCE",
  "broker": "Lucrum Capital",
  "server": "Lucrumcapital-Live",
  "profile": null,
  "ratingLink": null
}
INACTIVE MANAGERS (1):
6. GoldenTrade Provider ❌
{
  "name": "GoldenTrade",
  "displayName": "GoldenTrade Provider",
  "strategyName": "GoldenTrade",
  "status": "inactive",
  "executionMethod": "Copy Trade",
  "assignedAccounts": [886066],
  "fundType": "BALANCE",
  "broker": "MultiBank",
  "profile": null,
  "ratingLink": null,
  "notes": "NOT USING THIS MONTH - DO NOT DISPLAY"
}
 
💰 FUND ALLOCATION BREAKDOWN
BALANCE Fund: $100,000
Managers (4):
•       UNO14 Manager → Account 886602
•       TradingHub Gold → Account 886557
•       MultiBank BALANCE → Account 891215
•       MEXAtlantic → Account 897589
CORE Fund: $18,151.41
Managers (1):
•       CP Strategy → Accounts 885822, 897590, 891234
SEPARATION Fund: (Interest Earnings)
Purpose: Interest segregation accounts Accounts: 897591, 897599, 886528, 886066
 
🔗 EXTERNAL PROFILE LINKS
Links by Manager:
1.      UNO14 Manager:
o       Profile: https://www.fxblue.com/users/gestion_global
2.      CP Strategy:
o       Rating: https://ratings.mexatlantic.com/widgets/ratings/3157?widgetKey=social_platform_ratings
3.      TradingHub Gold:
o       Profile: https://ratings.multibankfx.com/widgets/ratings/1359?widgetKey=social_platform_ratings
o       Rating: https://ratings.multibankfx.com/widgets/ratings/1359?widgetKey=social_platform_ratings
4.      MultiBank BALANCE:
o       Profile: https://ratings.multibankfx.com/widgets/ratings/5201?widgetKey=social_platform_ratings
o       Rating: https://ratings.multibankfx.com/widgets/ratings/5201?widgetKey=social_platform_ratings
5.      MultiBank Separation Interest Accounts:
o       Profile: https://ratings.multibankfx.com/widgets/ratings/4119?widgetKey=social_platform_ratings
o       Accounts: 897591, 897599
 
💵 CLIENT INVESTMENTS
Client: Alejandro Mariscal Romero
Referred by: Salvador Palma (SP-2025)
Investment 1 - CORE:
{
  "client_id": "6909e8ebaaf69606babea152",
  "principal_amount": 18151.41,
  "fund_type": "FIDUS_CORE",
  "interest_rate": 0.015,
  "payment_frequency": "monthly",
  "contract_months": 14,
  "status": "active",
  "referred_by": "6909e8eaaaf69606babea151",
  "referred_by_name": "Salvador Palma"
}
Investment 2 - BALANCE:
{
  "client_id": "6909e8ebaaf69606babea152",
  "principal_amount": 100000.00,
  "fund_type": "FIDUS_BALANCE",
  "interest_rate": 0.025,
  "payment_frequency": "quarterly",
  "contract_months": 14,
  "status": "active",
  "referred_by": "6909e8eaaaf69606babea151",
  "referred_by_name": "Salvador Palma"
}
Total Investment: $118,151.41
 
👤 SALESPEOPLE
Salesperson 1: Salvador Palma ✅
{
  "_id": "6909e8eaaaf69606babea151",
  "name": "Salvador Palma",
  "email": "chava@alyarglobal.com",
  "phone": "+1234567891",
  "referral_code": "SP-2025",
  "total_sales_volume": 118151.41,
  "total_commissions_earned": 0,
  "total_clients_referred": 1,
  "active": true,
  "clients_referred": ["6909e8ebaaf69606babea152"]
}
Salesperson 2: Test Person ✅
{
  "name": "Test Person",
  "email": "test@test.com",
  "phone": "+1234567890",
  "referral_code": "TP-2025",
  "total_sales_volume": 0,
  "total_commissions_earned": 0,
  "total_clients_referred": 0,
  "active": true
}
Salesperson 3: Test Referral Person ✅
{
  "name": "Test Referral Person",
  "email": "test.referral@fidus.com",
  "phone": "+1234567890",
  "referral_code": "TRP-2025",
  "total_sales_volume": 0,
  "total_commissions_earned": 0,
  "total_clients_referred": 0,
  "active": true
}
 
📊 EXPECTED SYSTEM TOTALS
Portfolio Overview:
•       Total AUM: $129,450.66 (includes LUCRUM $11,299.25)
•       Active Managers: 6
•       Total MT5 Accounts: 14 (13 MEXAtlantic + 1 LUCRUM)
•       Total MT4 Accounts: 1 (MEXAtlantic)
•       Total Trading Accounts: 15
•       Active Funds: 2 (BALANCE, CORE)
Money Manager Rankings:
Rank 1: UNO14 Manager (BALANCE)
Rank 2: TradingHub Gold (BALANCE)
Rank 3: CP Strategy (CORE)
Rank 4: MultiBank BALANCE (BALANCE)
Rank 5: MEXAtlantic (BALANCE)
Rank 6: JOSE (BALANCE - Lucrum Capital)

NOT SHOWN: GoldenTrade (inactive)
Cash Flow & Performance:
•       Fund Assets: Sum of all active account balances
•       Fund Liabilities: Client interest obligations
•       Net P&L: Current equity - initial allocation
Referral System:
•       Active Salespeople: 3
•       Total Sales Volume: $118,151.41
•       Total Commissions: $0 (pending)
•       Pending Commissions: $0
 
🔧 STANDARD FIELD NAMES (MANDATORY)
MongoDB Collections (snake_case):
mt5_accounts collection:
{
  "account": 886602,  # Account number
  "balance": 10053.85,  # Account balance
  "equity": 10057.21,  # Current equity
  "profit": 0.00,  # Current profit/loss
  "margin": 0.00,  # Used margin
  "margin_free": 10057.21,  # Free margin
  "leverage": 100,  # Account leverage
  "currency": "USD",
  "fund_type": "BALANCE",  # BALANCE, CORE, SEPARATION
  "manager_name": "UNO14 Manager",
  "broker": "MultiBank",
  "status": "active",
  "updated_at": "2025-11-04T..."
}
money_managers collection:
{
  "name": "UNO14 Manager",
  "display_name": "UNO14 MAM Manager",
  "strategy_name": "UNO14 MAM Strategy",
  "assigned_accounts": [886602],
  "fund_type": "BALANCE",
  "execution_method": "MAM",
  "broker": "MultiBank",
  "profile_url": "https://...",
  "rating_url": "https://...",
  "total_allocated": 10000.00,
  "current_equity": 10057.21,
  "profit_loss": 57.21,
  "win_rate": 75.0,
  "status": "active",  # active or inactive
  "active": true,
  "updated_at": "2025-11-04T..."
}
investments collection:
{
  "client_id": ObjectId("6909e8ebaaf69606babea152"),
  "principal_amount": 18151.41,
  "fund_type": "FIDUS_CORE",
  "interest_rate": 0.015,
  "payment_frequency": "monthly",
  "contract_months": 14,
  "investment_date": "2024-09-01",
  "maturity_date": "2025-11-01",
  "status": "active",
  "referred_by": ObjectId("6909e8eaaaf69606babea151"),
  "referred_by_name": "Salvador Palma"
}
salespeople collection:
{
  "_id": ObjectId("6909e8eaaaf69606babea151"),
  "name": "Salvador Palma",
  "email": "chava@alyarglobal.com",
  "phone": "+1234567891",
  "referral_code": "SP-2025",
  "total_sales_volume": Decimal128("118151.41"),
  "total_commissions_earned": Decimal128("0"),
  "total_clients_referred": 1,
  "commissions_pending": Decimal128("0"),
  "commissions_paid": Decimal128("0"),
  "active": true,
  "payment_info": {
    "wallet_address": "",
    "wallet_type": "crypto_wallet"
  },
  "created_at": "2025-11-01T...",
  "updated_at": "2025-11-04T..."
}
API Responses (camelCase):
All API responses MUST transform to camelCase:
// MT5 Account
{
  "accountNumber": 886602,
  "accountBalance": 10053.85,
  "accountEquity": 10057.21,
  "profitLoss": 0.00,
  "usedMargin": 0.00,
  "freeMargin": 10057.21,
  "accountLeverage": 100,
  "currency": "USD",
  "fundType": "BALANCE",
  "managerName": "UNO14 Manager",
  "broker": "MultiBank",
  "status": "active"
}

// Money Manager
{
  "name": "UNO14 Manager",
  "displayName": "UNO14 MAM Manager",
  "strategyName": "UNO14 MAM Strategy",
  "assignedAccounts": [886602],
  "fundType": "BALANCE",
  "executionMethod": "MAM",
  "broker": "MultiBank",
  "profileUrl": "https://...",
  "ratingUrl": "https://...",
  "totalAllocated": 10000.00,
  "currentEquity": 10057.21,
  "profitLoss": 57.21,
  "winRate": 75.0,
  "status": "active",
  "active": true
}

// Investment
{
  "clientId": "6909e8ebaaf69606babea152",
  "principalAmount": 18151.41,
  "fundType": "FIDUS_CORE",
  "interestRate": 0.015,
  "paymentFrequency": "monthly",
  "contractMonths": 14,
  "investmentDate": "2024-09-01",
  "maturityDate": "2025-11-01",
  "status": "active",
  "referredBy": "6909e8eaaaf69606babea151",
  "referredByName": "Salvador Palma"
}

// Salesperson
{
  "id": "6909e8eaaaf69606babea151",
  "name": "Salvador Palma",
  "email": "chava@alyarglobal.com",
  "phone": "+1234567891",
  "referralCode": "SP-2025",
  "totalSalesVolume": 118151.41,
  "totalCommissionsEarned": 0,
  "totalClientsReferred": 1,
  "commissionsPending": 0,
  "commissionsPaid": 0,
  "active": true
}
 
⚠️ CRITICAL RULES - DO NOT VIOLATE
1. Manager Filtering:
# ✅ CORRECT - Shows 5 active managers
managers = await db.money_managers.find({"status": "active"}).to_list(None)

# ❌ WRONG - Shows all including GoldenTrade
managers = await db.money_managers.find({}).to_list(None)
2. Account Grouping:
# ✅ CORRECT - Groups by fund_type
BALANCE_accounts = [886602, 886557, 891215, 897589]
CORE_accounts = [885822, 897590, 891234]
SEPARATION_accounts = [897591, 897599, 886528, 886066]

# ❌ WRONG - Hardcoded lists
accounts = [886602, 886557, 885822]  # Missing accounts!
3. Field Transformations:
# ✅ CORRECT - Transform at API boundary
@router.get("/api/endpoint")
async def get_data():
    data = await db.collection.find({}).to_list(None)
    return [transform_function(item) for item in data]

# ❌ WRONG - Return raw MongoDB data
@router.get("/api/endpoint")
async def get_data():
    data = await db.collection.find({}).to_list(None)
    return data  # Missing transformation!
4. Investment Linking:
# ✅ CORRECT - Link by client_id (ObjectId)
investment = {
    "client_id": ObjectId("6909e8ebaaf69606babea152"),
    "principal_amount": 100000.00
}

# ❌ WRONG - String ID or wrong field name
investment = {
    "client_id": "client_alejandro",  # Wrong!
    "amount": 100000.00  # Wrong field name!
}
5. Decimal128 Handling:
# ✅ CORRECT - Convert Decimal128 to float
def safe_decimal(value):
    if isinstance(value, Decimal128):
        return float(value.to_decimal())
    return float(value) if value else 0.0

# ❌ WRONG - Return Decimal128 directly
return {"amount": salesperson["total_sales_volume"]}  # Will break JSON!
 
📝 TESTING CHECKLIST
Before claiming ANY fix is complete, verify:
□ Money Managers shows 5 active (not 6, not 3)
□ GoldenTrade is NOT displayed
□ All manager profiles link correctly
□ Cash Flow shows real totals (not $0)
□ Trading Analytics shows positive P&L
□ MT5 Accounts shows all 11 accounts
□ Account allocations sum correctly
□ Salvador shows $118,151.41 total
□ Salvador detail page loads (not 404)
□ No console errors anywhere
□ All fields in camelCase (frontend)
□ All transformations applied
□ No Decimal128 errors
 
🎯 EMERGENT - YOUR MANDATE
Use this document as your SINGLE SOURCE OF TRUTH.
•       ✅ All account numbers are here
•       ✅ All manager details are here
•       ✅ All fund allocations are here
•       ✅ All field names are here
•       ✅ All transformation rules are here
DO NOT:
•       ❌ Guess account numbers
•       ❌ Create new field names
•       ❌ Filter accounts arbitrarily
•       ❌ Skip transformations
•       ❌ Ignore this structure
If something is unclear, ASK. Don't guess.
 
Now continue with Priority 3: Fix Cash Flow using THIS data structure! 🚀

---

## 14. SECURITY & AUTHENTICATION

### 14.1 Admin User Credentials

**Created:** November 25, 2025  
**Last Updated:** November 25, 2025

#### Primary Admin (Existing - DO NOT MODIFY)

| Field | Value |
|-------|-------|
| Username | admin |
| Password | password123 |
| Type | admin |
| Status | active |
| Collection | users |
| Notes | Production admin account |

#### Test Admin (Created 2025-11-25)

| Field | Value |
|-------|-------|
| Username | emergent_admin |
| Password | admin123 ✅ |
| Email | chavany@me.com |
| Type | admin |
| Status | active |
| Collection | users |
| Purpose | Testing and development |
| Notes | Uses temp_password field for login |

**Login Endpoint:** `/api/auth/login`

**Authentication Method:**
- JWT-based authentication
- Password stored in `temp_password` field (plaintext as per system design)
- Fallback to "password123" if temp_password doesn't match
- Token expires after configured duration

**Usage:**
```bash
# Login via API
curl -X POST http://localhost:8001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123",
    "user_type": "admin"
  }'
```

**Frontend Login:**
1. Navigate to Admin Login page
2. Enter username: `admin`
3. Enter password: `admin123`
4. System returns JWT token for authenticated requests

**Security Notes:**
- Admin account has full access to all dashboard features
- Password should be changed after first login for production use
- JWT tokens must be included in Authorization header for protected endpoints
- Format: `Authorization: Bearer <token>`

### 14.2 Recent Changes

**November 25, 2025 - Cash Flow Simplification Complete**
- Fixed critical MT5 watchdog `tzinfo` bug (datetime string parsing)
- Created new `SimpleCashFlowDashboard.js` component (210 lines)
- Replaced old complex component (2055 lines) with simplified 6-metric view
- Fixed `/api/admin/cashflow/complete` endpoint undefined variable errors
- Created two admin users: `admin` (password123) and `emergent_admin` (admin123)
- All services operational, Cash Flow UI verified and working

### 14.3 Future Configuration Tasks

**GITHUB_TOKEN Configuration (Low Priority)**
- Purpose: Enable MT5 Watchdog auto-healing feature
- Current Status: Not configured
- Impact: Auto-healing attempts will fail but system continues to operate
- Action Required: Configure GITHUB_TOKEN environment variable for automated VPS service restarts
- Priority: Low (system functions without this)

**VPS Bridge Notes**
- VPS bridges run on Windows VPS (217.197.163.11)
- Bridges push data directly to MongoDB
- Connection errors to 92.118.45.135:8000 are expected when VPS is offline
- Backend does NOT need to connect to VPS - data flow is one-way (VPS → MongoDB)

---

<img width="468" height="625" alt="image" src="https://github.com/user-attachments/assets/e405fe15-fcdd-4db6-b38c-464d0fc84c58" />
