name: Deploy Frontend to Emergent.host

on:
  push:
    branches: [main]
    paths:
      - 'frontend/**'
      - '.github/workflows/deploy-frontend.yml'
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Trigger Emergent.host deployment
        run: |
          echo "üöÄ Triggering frontend deployment via webhook..."
          
          # Trigger webhook if configured
          if [ -n "${{ secrets.EMERGENT_WEBHOOK_URL }}" ]; then
            curl -X POST "${{ secrets.EMERGENT_WEBHOOK_URL }}" \
              -H "Content-Type: application/json" \
              -d '{"ref":"main","repository":"fidus-investment-platform"}'
            echo "‚úÖ Webhook triggered successfully"
          else
            echo "‚ö†Ô∏è EMERGENT_WEBHOOK_URL not configured"
            echo "‚ÑπÔ∏è  Frontend will auto-deploy via Emergent git integration"
          fi
      
      - name: Wait for deployment
        run: |
          echo "‚è≥ Waiting 90 seconds for build to complete..."
          sleep 90
      
      - name: Verify deployment
        run: |
          echo "üîç Verifying frontend is accessible..."
          response=$(curl -s -o /dev/null -w "%{http_code}" https://fidus-invest.emergent.host)
          if [ $response -eq 200 ]; then
            echo "‚úÖ Frontend deployment successful!"
            echo "üåê URL: https://fidus-invest.emergent.host"
          else
            echo "‚ö†Ô∏è Frontend may still be building (HTTP $response)"
            echo "Check status at: https://fidus-invest.emergent.host"
          fi
