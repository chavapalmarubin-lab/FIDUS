<analysis>**original_problem_statement:**
The user's initial goal was to fix a broken production financial dashboard, which evolved into a comprehensive platform refactor to enforce a Single Source of Truth (SSOT) architecture. The user is highly technical, provides very specific instructions, and expects fast execution.

The most recent tasks involved fixing the Referrals tab, implementing a Wealth Calendar, performing a critical architectural refactor of the Fund Portfolio page, managing MT4/MT5 account passwords, removing a section from the public-facing prospects page, and now, debugging a new MT4 account connection issue.

**User's preferred language**: English

**what currently exists?**
The application is a full-stack financial dashboard (React + FastAPI + MongoDB). It has undergone significant refactoring and bug fixing.

-   **Architecture:** A critical architectural flaw was corrected. The application now properly distinguishes between **Total Fund Assets** (a single pool of money from all MT5/MT4 trading accounts) and **Client Obligations** (what the company owes clients based on their investment products like CORE, BALANCE, DYNAMIC).
-   **Frontend:** The UI has been substantially improved.
    -    was completely rewritten to reflect the new, correct architecture.
    -   A new  component was added to  to show fund health and projections.
    -   The  public page was updated to remove a specified marketing section.
-   **Backend:** Key API endpoints for investments, cash flow, and referrals have been fixed. Logic was corrected to handle data inconsistencies (like MongoDB s) and to align with business requirements (like salesperson sorting).
-   **DevOps:** A GitHub Action workflow () was created to facilitate updating trading account passwords in the MongoDB database.

**Last working item**:
-   **Last item agent was working:** Investigating a connection failure for a new **Traders Trust MT4 account (1309411)**. The user provided screenshots showing it fails with an Invalid account error, while another MEX Atlantic account is working correctly.
-   **Status:** IN PROGRESS
-   **Agent Testing Done:** N
-   **Which testing method agent to use?** Backend investigation. First, use  to query the  collection in MongoDB to check for the credentials of account .
-   **User Testing Done:** Y (User provided screenshots confirming the Invalid account error).

**All Pending/In progress Issue list**:
-   **Issue 1: Traders Trust MT4 account (1309411) connection failed (P0)**

**Issues Detail:**
-   **Issue 1: Traders Trust MT4 account (1309411) connection failed**
    -   **Attempted fixes:** None yet. This is a new issue.
    -   **Next debug checklist:**
        1.  Connect to the database and inspect the  collection.
        2.  Search for an entry where the  number is .
        3.  **If an entry exists:** Verify the  and  fields are correct. The user's screenshot shows the server is likely .
        4.  **If no entry exists:** Inform the user that the account is not configured in the database and ask for the correct  and  to create the configuration entry.
    -   **Why fix this issue and what will be achieved with the fix?** To successfully integrate the new Traders Trust account into the platform, allowing its performance to be tracked in real-time.
    -   **Status:** IN PROGRESS
    -   **Is recurring issue?** N
    -   **Should Test frontend/backend/both after fix?** Backend first to confirm the connection works. Then, frontend (screenshot tool) to verify the account and its data appear correctly on the Fund Portfolio dashboard.
    -   **Blocked on other issue:** None.

**In progress Task List**:
-   None.

**Upcoming and Future Tasks**
-   **Upcoming Tasks:**
    -   (P1) Configure  for MT5 bridge auto-healing.
-   **Future Tasks:**
    -   (P2) Remove obsolete V1 API code and old/backup frontend components (e.g., ).
    -   (P2) Implement Referral Link Analytics Backend.

**Completed work in this session**
-   **Architectural Overhaul:**
    -   Completely refactored the **Fund Portfolio** page () to correctly separate Fund Assets (one pool of MT5 money) from Client Obligations (what is owed based on products).
-   **Feature Implementation:**
    -   Created and integrated a new **Wealth Calendar** UI component () into the Cash Flow tab.
-   **Critical Bug Fixes:**
    -   **Investments Tab:** Fixed a  by resolving MongoDB  serialization issues in  and cleaning corrupted database records.
    -   **Referrals Tab:** Fixed a bug that was hiding a key salesperson and corrected the sorting logic to be based on sales performance ().
    -   **Ready Clients Filter:** Corrected the logic to ensure all active clients were being counted.
    -   **Cash Flow UI:** Fixed the timeline to correctly display a per-client breakdown of payments.
-   **DevOps & Maintenance:**
    -   Created a **GitHub Action** () to allow for easier updates of trading account passwords stored in the database.
    -   Updated passwords for all 21 MEX Atlantic & Lucrum Capital accounts in the MongoDB  collection.
    -   Removed a Seguridad Garantizada marketing card from the public prospects page () and all translation files.
    -   Created a new referral agent portal for Carol.

**Earlier issues found/mentioned but not fixed**
-   **Issue 1: Lucrum MT5 Bridge Has Duplicate Key Errors (P2)**
    -   **Debug checklist:** Investigate the  service on the VPS to see why  operations are failing. This may be due to a code version mismatch or an issue with the upsert logic itself.
    -   **Why to solve this issue and what will be achieved with this?** Ensures complete and accurate historical deal data is available for all Lucrum accounts.
    -   **Should Test frontend/backend/both after fix:** Backend.
    -   **Is recurring issue?** Y
-   **Issue 2: Failing logins for three specific referral agents (P2)**
    -   **Debug checklist:** Identify the affected referral agents. Check their records in the  and  collections. Verify their credentials and account status.
    -   **Why to solve this issue and what will be achieved with this?** To ensure all authorized referral agents can access their dashboard.
    -   **Should Test frontend/backend/both after fix:** Backend (login API) and Frontend (login flow).
    -   **Is recurring issue?** N

**Known issue recurrence from previous fork**
-   None. The major recurring issue with the Investments Tab 500 error was definitively fixed by addressing the root cause (ObjectId serialization).

**Code Architecture**


**Key Technical Concepts**
-   **Single Source of Truth (SSOT):** The core architectural principle guiding the project. The platform now correctly understands that Fund Assets (from MT5 accounts) are a single pool used to meet Client Obligations (defined by investment products).
-   **MongoDB  Serialization:** A critical bug was caused by improper handling of MongoDB's . The fix required adding  to queries and cleaning string fields that contained  values.
-   **GitHub Actions:** Used for a custom, manually-triggered workflow to manage database credentials, separating infrastructure tasks from application code.
-   **i18next Internationalization:** The public-facing pages support multiple languages using JSON translation files.

**key DB schema**
-   : Source of truth for client obligations. Defines  and  (CORE, BALANCE, etc.).
-   : Contains real-time equity and P&L data synced from trading accounts.
-   : Stores connection credentials (, , ) for each trading account. **This is the key collection for debugging the current issue.**
-   : Stores data for referral agents. Was fixed to have consistent  and  fields.

**changes in tech stack**
-   None.

**All files of reference**
-   : Main FastAPI application file where multiple endpoints were fixed.
-   : Central calculation service where  bugs were fixed.
-   : API routes for the Referrals tab; sorting and filtering logic was corrected here.
-   : Core UI component that was completely rewritten.
-   : New component created for the Wealth Calendar feature.
-   : Public-facing component that was modified to remove a marketing element.
-   : New GitHub Action workflow file.
-   : Directory containing , , , and  files that were edited.

**Areas that need refactoring**:
-   The backend in  remains monolithic and could be broken down into smaller, more manageable route files by feature.
-   Old and backup files (, ) in the frontend directory should be deleted to clean up the codebase.

**key api endpoints**
-   : Fixed (no longer returns 500 error).
-   : Fixed (now sorts by sales volume and filters correctly).
-   : A key endpoint used by the new  component.

**Critical Info for New Agent**
-   The user is direct and provides clear, multi-step instructions. Follow them precisely.
-   The core architectural concept is: **MT5 accounts = ONE fund pool. Client products (CORE/BALANCE/DYNAMIC) = OBLIGATIONS.** Do not mix these. The Fund Portfolio UI now reflects this correctly.
-   Trading account credentials are not in  files; they are stored in the  collection in MongoDB. This is where you must look to debug the current Invalid account issue.
-   The production environment is updated only when the user performs a Save to GitHub, which triggers a Render deployment. Your local preview will be ahead of production.

**documents and test reports created in this job**
-   

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** Asks about updating the password for a Lucrum Capital account in addition to MEX Atlantic. (COMPLETED)
2.  **Agent:** Confirms and notes that there are 7 Lucrum accounts in the DB.
3.  **User:** Confirms to update all 7 Lucrum accounts. (COMPLETED)
4.  **Agent:** Updates all accounts in MongoDB and provides a final prompt for the user's VPS admin.
5.  **User:** Asks for a GitHub Action to update VPS accounts. (CLARIFIED/IMPLEMENTED)
6.  **Agent:** Clarifies that a GitHub Action can only update the database, not the VPS terminals directly. Creates the database update workflow.
7.  **User:** Reports that the Run workflow button is missing on GitHub. (RESOLVED)
8.  **Agent:** Explains how to find the button and confirms the YAML is valid.
9.  **User:** Provides new, comprehensive instructions for the VPS admin, including details about automated scripts. (INFO)
10. **User:** Reports that the dashboard is showing incorrect fund totals, providing a screenshot of the OLD, broken UI. (RESOLVED - agent confirmed fix was not yet deployed to production).
11. **User:** Asks to remove the Seguridad Garantizada section from the public prospects page. (COMPLETED)
12. **User:** Reports a connection failure for a Traders Trust MT4 account, providing screenshots. (**CURRENT TASK**)

**Project Health Check:**
-   **Broken**:
    -   Connection to Traders Trust MT4 account  is failing with Invalid account.
-   **Mocked**:
    -   None.

**3rd Party Integrations**
-   **Render:** Used for hosting and deployment.
-   **MongoDB Atlas:** Production database.
-   **GitHub Actions:** Used for a custom CI workflow to update database records.

**Testing status**
-   **Testing agent used after significant changes:** YES. Both frontend and backend testing agents were used to verify major fixes and features.
-   **Troubleshoot agent used after agent stuck in loop:** YES.
-   **Test files created:** None persistent.
-   **Known regressions:** None.

**Credentials to test flow:**
-   **Admin Username**: 
-   **Admin Password**: 

**What agent forgot to execute**
-   The agent did not begin work on two less critical issues from the original handoff summary: Lucrum MT5 Bridge Has Duplicate Key Errors and Failing logins for three specific referral agents. These have been carried forward to the Earlier issues found/mentioned but not fixed section.</analysis>
