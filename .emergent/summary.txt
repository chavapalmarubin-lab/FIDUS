<analysis>**original_problem_statement:**
The user's initial goal was to rebuild a Referral Agent Portal with a professional dark theme, enhanced dashboard, CRM, and referral tools. After successfully completing this, the user requested a new major feature: the Investment Committee Tab for managing fund allocations.

After the agent built a fully functional first version of this feature (modal-based, capital allocation), the user provided a new, final specification for a **complete redesign**. The feature must now be a **drag-and-drop interface** where individual MT5 accounts are assigned to managers, funds, brokers, and platforms. This fundamentally changes the architecture from capital-based to account-based assignment.

The user has emphasized the need for a scalable, automated process for adding new MT5 accounts to the entire system (VPS, Backend, and Database) in the future, which has become a core part of the current task.

PRODUCT REQUIREMENTS:
1.  **Redesign Investment Committee Tab:** Scrap the modal-based UI and implement a new drag-and-drop interface.
2.  **Account-Centric Logic:** The system must revolve around assigning 13 specific MT5 accounts to different categories.
3.  **Multi-Assignment:** An MT5 account must support simultaneous assignment to a manager, a fund, a broker, and a trading platform.
4.  **Critical Prerequisite:** Add two new MT5 accounts (901351 and 901353) to all parts of the application infrastructure: the VPS MT5 Bridge Service, the backend API, and the MongoDB database.
5.  **Backend Overhaul:** The backend endpoints and services must be rewritten to support the new account-assignment logic.
6.  **Automated Account Onboarding:** Create a robust, automated method (preferably a GitHub Action) to add new MT5 accounts to the system in the future.

**User's preferred language**: English

**what currently exists?**
The application is a full-stack platform (React, FastAPI, MongoDB).
1.  **Referral Agent Portal:** A fully functional and complete module.
2.  **Investment Committee Tab (Version 2 - In Progress):**
    *   **Database:** The two new MT5 accounts (901351, 901353) have been successfully added to the  collection in MongoDB, and the schema for all 13 accounts has been updated to support multi-assignment.
    *   **Backend:** The obsolete V1 capital-allocation APIs have been replaced with 7 new account-assignment APIs in . These have been tested successfully via a local script. A critical bug preventing MongoDB  updates during the sync process was also fixed.
    *   **Frontend:** The UI has been completely rebuilt using  for drag-and-drop functionality. It includes an Unassigned Accounts section and is integrated into the Admin Dashboard.
3.  **CI/CD:** Several GitHub Actions workflows were created to automate adding accounts. The latest is .
4.  **Obsolete Code:** The V1 implementation of the Investment Committee feature (modal-based UI and capital-allocation APIs) still exists but is no longer used.

**Last working item**:
-   **Last item agent was working:** The agent was tasked with debugging a critical issue where the VPS MT5 Bridge service was not loading the two new MT5 accounts (901351, 901353), despite them being present in the MongoDB database. The VPS logs clearly showed Loaded credentials from MongoDB for 11 accounts. The user provided a detailed, mandatory investigation plan to systematically diagnose and fix the root cause, which is likely a filtering issue in the VPS service code.
-   **Status:** IN PROGRESS
-   **Agent Testing Done:** N
-   **Which testing method agent to use?** The next agent MUST follow the user's prescribed investigation plan.
    1.  Create and run the  script on the VPS to inspect the  collection in MongoDB and verify the status of the new accounts.
    2.  Based on the script's output, analyze the account loading logic in the VPS service file () to find the incorrect filter.
    3.  Fix the filter in the VPS code or update the account documents in MongoDB to match the existing filter.
    4.  Restart the VPS service and verify the logs show 13 accounts.
-   **User Testing Done:** Y (User confirmed via screenshot that the VPS logs show only 11 accounts being loaded).

**All Pending/In progress Issue list**:
-   **Issue 1: VPS MT5 Bridge Service Not Syncing All Accounts (P0 - BLOCKER)**
    -   **Description:** The VPS service, which reads account data from MongoDB, is only loading 11 of the 13 accounts. The two new accounts (901351, 901353) are being ignored. This prevents them from being available for trading and management, blocking the entire feature.
    -   **Status:** IN PROGRESS
    -   **Is recurring issue?** Y (This is the core problem of the last several interactions).
    -   **Next debug checklist:**
        -   Follow the user-provided plan in  precisely.
        -   Start by creating and running the  script on the VPS.
        -   Analyze the output to understand why the accounts are being filtered out.
        -   Inspect the MongoDB query in . The filter is likely too strict (e.g., ) and needs to be relaxed to include .
    -   **Why fix this issue and what will be achieved with the fix?** Fixing this will allow all 13 accounts to be synced by the VPS, making the new drag-and-drop Investment Committee feature fully functional and testable end-to-end.
    -   **Blocked on other issue:** No. This is the primary blocker.

**In progress Task List**:
There are no other tasks in progress. The entire focus is on resolving the P0 blocker.

**Upcoming and Future Tasks**
**Upcoming Tasks:**
-   **Task 1: Complete VPS Sync Fix and Verification (P0):**
    -   Execute the debug plan for the P0 issue.
    -   Verify that VPS logs show 13/13 accounts synced.
    -   Verify that the backend service on Render also shows 13/13 accounts synced.
-   **Task 2: End-to-End Feature Testing (P1):**
    -   Once the VPS sync is fixed, perform a full test of the drag-and-drop UI.
    -   Drag unassigned accounts to managers and funds, confirm UI updates, and verify database changes.
-   **Task 3: Documentation and Cleanup (P1):**
    -   Update  with the new architecture, API endpoints, and the final, working procedure for adding MT5 accounts.
    -   Remove all obsolete V1 code for the Investment Committee feature.

**Future Tasks:**
-   **Task 4: Implement Referral Link Analytics (P2):** The UI exists but needs a functional backend.
-   **Task 5: Platform-wide Refactoring (P2):** Replace MultiBank with MEXAtlantic and consolidate duplicate API definitions.

**Completed work in this session**
-   **Database Seeding:** Successfully added MT5 accounts 901351 and 901353 to the  collection in MongoDB with an unassigned status.
-   **Backend Rewrite:** Replaced the V1 Investment Committee APIs with 7 new V2 APIs for account-based assignment. The new router is active in .
-   **Backend Bug Fix:** Fixed a critical bug in  where the code was incorrectly trying to update the immutable  field in MongoDB.
-   **Frontend Implementation:** Built a complete drag-and-drop UI using , including components for listing MT5 accounts and drop zones for managers, funds, brokers, and platforms.
-   **CI/CD Automation:** Created and iterated on multiple GitHub Actions workflows to automate adding accounts to the VPS, culminating in a final version that targets the correct VPS script file ().

**Earlier issues found/mentioned but not fixed**
-   **Issue 1: Referral Link Analytics Backend:** The UI for this feature on the Profile page displays placeholder data (0 values). The backend logic to track and serve click/lead/conversion data has not been implemented.

**Known issue recurrence from previous fork**
-   None.

**Code Architecture**


**Key Technical Concepts**
-   **Frameworks**: React, FastAPI
-   **Database**: MongoDB (specifically MongoDB Atlas)
-   **UI Technology**:  for drag-and-drop.
-   **Deployment**: Backend/Frontend on Render.com, MT5 Bridge Service on a separate VPS.
-   **CI/CD**: GitHub Actions for automating VPS configuration changes via SSH.
-   **System Architecture**: A three-part system for account management:
    1.  **MongoDB:** The source of truth for account configurations.
    2.  **VPS MT5 Bridge Service:** Reads from MongoDB to connect to MT5 terminals.
    3.  **Backend API (Render):** Reads from MongoDB to serve data to the frontend.

**key DB schema**
-   ****: The primary collection used by the backend API.
    -   
    -   
    -   
    -   
    -   
    -   
-   ****: **CRITICAL:** This collection is mentioned in the user's latest debug instructions and appears to be what the **VPS service** reads from. The agent MUST investigate and potentially work with this collection to solve the P0 issue.

**changes in tech stack**
-   Frontend: , ,  were added.
-   CI/CD: GitHub Actions with SSH is now a core part of the deployment process for the VPS.

**All files**
*   **Created/Modified (Relevant for Next Step):**
    *   : The latest (and hopefully correct) workflow for updating the VPS. The target file was changed to .
    *   : Fixed  update bug in .
    *   : Contains the 7 new APIs.
    *   : The main V2 container component.
    *   : Updated to render the new  component.
*   **To be created on VPS:**
    *   : The debugging script provided by the user.

**Areas that need refactoring**:
-   The entire V1 implementation of the Investment Committee feature (, , and several components in ) is obsolete and should be deleted once the V2 feature is verified.
-   The  directory contains multiple failed attempts at creating the automation. These should be cleaned up, leaving only the final working version.

**key api endpoints**
*   **New V2 Endpoints (Implemented):**
    *   
    *   
    *   
    *   
    *   
    *   
    *   

**Critical Info for New Agent**
-   **P0 Blocker:** Your absolute first priority is to fix the VPS sync issue. The user has provided a mandatory, step-by-step investigation plan in . You **MUST** follow it. Do not attempt other solutions before completing the investigation.
-   **File Name Correction:** The correct service file on the VPS is , NOT . The agent spent significant time targeting the wrong file.
-   **Database Collection Discrepancy:** The agent was working with the  collection. However, the user's final debug instructions and VPS logs reference a  collection. It is highly likely the VPS service reads from . Your investigation script targets this collection. You must confirm this and ensure data is consistent between the two if both are required.
-   **User Goal:** The user wants a robust, scalable, and automated process for adding new accounts. The GitHub Actions approach is the desired final solution. Although it has failed multiple times, the goal is to make it work.
-   **VPS Access:** You will need to use tools that can execute commands on a remote VPS via SSH to perform the investigation.

**documents created in this job**
-   : GitHub Action to update the correct file on the VPS.
-   : A manual PowerShell script to add accounts on the VPS.
-   : Script to ensure accounts are in MongoDB.
-   : A PowerShell script for manual VPS update.

**Last 5 User Messages and any pending user messages**
1.  **User:** Pointed out that the VPS logs show only 11 accounts, meaning the new accounts are not being loaded. (Issue raised)
2.  **Agent:** Proposed a manual PowerShell script to run on the VPS to add the accounts. (Agent solution)
3.  **User:** Rejected manual work and demanded a GitHub Action. (User rejected solution, reiterated goal)
4.  **Agent:** Created a new GitHub action () targeting the correct filename on the VPS. (Agent attempted new solution)
5.  **User:** The workflow failed again. The user then provided a detailed, systematic investigation plan and instructed the agent to follow it exactly to find the root cause of why the VPS isn't loading the accounts from MongoDB. (User provided mandatory debug plan)

**Project Health Check:**
-   **Broken**: The core functionality of the new Investment Committee feature is broken because the VPS service is not syncing all accounts from the database. This is the P0 blocker.
-   **Mocked**: Referral Link Analytics on the profile page use placeholder data.

**Testing status**
-   **Testing agent used after significant changes**: NO (Not for the V2 feature).
-   **Troubleshoot agent used after agent stuck in loop**: NO
-   **Test files created**:
    -   : A script to test the V2 backend APIs directly, bypassing authentication.
-   **Known regressions**: None.

**Credentials to test flow:**
-   **Salvador Palma (Admin Agent):**
    -   Email: 
    -   Password: 
-   **VPS RDP Access:**
    -   IP: 
    -   User: 
    -   Pass: 
-   **GitHub Secrets (for workflows):**
    -   , , , 

**What agent forgot to execute**
The agent repeatedly failed to create a working GitHub Action because it lacked a full understanding of the VPS environment (correct filename, file structure, SSH port vs. service port). Instead of systematically debugging the connection and file structure, it kept creating new, slightly different, non-working workflows. The user ultimately had to provide a detailed, manual investigation plan, which the previous agent should have devised itself.</analysis>
