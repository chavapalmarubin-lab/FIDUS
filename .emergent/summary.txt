<analysis>**original_problem_statement:**
The user's initial goal was to rebuild a Referral Agent Portal with a professional dark theme, enhanced dashboard, CRM, and referral tools. After successfully completing this, the user requested a new major feature: the Investment Committee Tab for managing fund allocations.

After the agent built a fully functional first version of this feature (modal-based, capital allocation), the user provided a new, final specification for a **complete redesign**. The feature must now be a **drag-and-drop interface** where individual MT5 accounts are assigned to managers, funds, brokers, and platforms, fundamentally changing the architecture from capital-based to account-based assignment.

PRODUCT REQUIREMENTS:
1.  **Redesign Investment Committee Tab:** Scrap the modal-based UI and implement a new drag-and-drop interface as per the latest user specification ().
2.  **Account-Centric Logic:** The system must revolve around assigning 13 specific MT5 accounts to different categories (10 managers, 5 funds, 2 brokers, 2 platforms).
3.  **Multi-Assignment:** An MT5 account must support simultaneous assignment to a manager, a fund, a broker, and a trading platform.
4.  **Critical Prerequisite:** Before any UI work, two new MT5 accounts (901351 and 901353) must be added to the  database collection.
5.  **Backend Overhaul:** The backend endpoints and services must be rewritten to support the new account-assignment logic, primarily by updating fields in the  collection.

**User's preferred language**: English

**what currently exists?**
The application is a full-stack platform (React, FastAPI, MongoDB).
1.  **Referral Agent Portal:** Fully functional and complete, including login, dashboard, CRM, and referral link/QR code tools.
2.  **Investment Committee Tab (Version 1 - OBSOLETE):** A complete, modal-based version of the feature was built. The backend (7 APIs, services for capital allocation using  collection) is fully implemented and tested. The frontend (6+ React components, integrated into the admin dashboard) was also built and bugs were fixed. **This entire implementation is now obsolete due to a complete redesign request from the user.**

**Last working item**:
-   **Last item agent was working:** The agent acknowledged the user's request for a complete redesign of the Investment Committee tab to a drag-and-drop interface. The agent was about to execute the first critical step of this new plan: adding two new MT5 accounts to the database.
-   **Status:** NOT STARTED
-   **Agent Testing Done:** N
-   **Which testing method agent to use?**
    -   To add the new accounts: a backend Python script followed by a manual MongoDB query for verification.
    -   For the full feature: Backend APIs should be tested via  or a new test script. The frontend UI will require the  and end-to-end testing with the  to validate the drag-and-drop functionality.
-   **User Testing Done:** N

**All Pending/In progress Issue list**:
-   **Issue 1: Obsolete Feature Implementation (P0):** The recently completed modal-based Investment Committee Tab is now entirely obsolete due to a change in user requirements. The code for this feature (backend services, routes, and frontend components) needs to be either removed or completely replaced by the new drag-and-drop implementation.

**In progress Task List**:
There are no tasks currently in progress. The previous task was completed and the new one is about to begin.

**Upcoming and Future Tasks**
**Upcoming Tasks:**
-   **Task 1: Implement Drag-and-Drop Investment Committee Tool (P0):** This is a complete redesign based on the user's latest specification ().
    -   **Phase 0 (Blocking):** Add new MT5 accounts (901351, 901353) to the  collection using the provided script.
    -   **Phase 1 (Backend):** Rewrite the  routes. Create new endpoints for getting all MT5 accounts and assigning/un-assigning them to managers and funds by updating the  documents.
    -   **Phase 2 (Frontend Setup):** Install the  library.
    -   **Phase 3 (Frontend Build):** Create the new drag-and-drop UI, including the , , and  components.
    -   **Phase 4 (Testing):** Perform end-to-end testing of the drag-and-drop functionality.

**Future Tasks:**
-   **Task 2: Implement Referral Link Analytics (P2):** The UI for this exists on the Profile page but displays placeholder data. The backend logic to track and serve click/lead/conversion data needs to be implemented.
-   **Task 3: Platform-wide Refactoring (P2):**
    -   Replace all instances of MultiBank with MEXAtlantic.
    -   Consolidate any duplicate API endpoint definitions in .

**Completed work in this session**
-   **Implemented Investment Committee Tab (Version 1 - Now Obsolete):**
    -   **Backend:** Created  and  collections. Built and tested 7 API endpoints in  and business logic in  for managing capital-based allocations.
    -   **Frontend:** Created a new Investment Committee tab in . Developed a full suite of React components in  for a modal-based UI.
    -   **Bug Fixes:**
        -   Fixed frontend authentication by adding JWT token headers to all API calls within the new components.
        -   Fixed  errors on null data by adding safety checks in  and .

**Earlier issues found/mentioned but not fixed**
-   **Issue 1: Referral Link Analytics Backend:** The UI was created in a previous session with placeholder 0 values, but the backend tracking and API logic have not been built.
    -   Status: NOT STARTED

**Known issue recurrence from previous fork**
-   None observed in this session. The agent correctly handled database context and did not encounter deployment issues.

**Code Architecture**


**Key Technical Concepts**
-   **Frameworks**: React (frontend), FastAPI (backend)
-   **Database**: MongoDB
-   **Architecture Shift**: The core logic is pivoting from a capital-allocation model (using dedicated  documents) to an account-assignment model (updating fields like  and  within the  collection).
-   **UI Technology**: The new UI will be built using a drag-and-drop library ().

**key DB schema**
-   ****: (OBSOLETE) Stored the state of capital allocation for each fund.
-   ****: (PARTIALLY OBSOLETE) Tracked changes to capital allocations. A similar history might be needed for account assignments.
-   ** (Enhanced)**: This is now the central collection. It must be enhanced with new fields to track assignments:
    -   
    -   
    -   
    -   
-   ****: Stores data about the 10 active managers.

**changes in tech stack**
-   The frontend will require the installation of  and related packages.

**All files**
*   **Created/Modified (Now Obsolete/Needs Rewrite):**
    *   : DB seeding script for the old model.
    *   : Business logic for capital allocation.
    *   : API routes for the old model.
    *   : All React components for the modal-based UI.
*   **Modified (Still Relevant):**
    *   : Added the  router.
    *   : Added the Investment Committee tab and content panel.
    *   : Used for fixing frontend authentication.

**Areas that need refactoring**:
-   The entire first implementation of the Investment Committee feature is now technical debt. All related files in , , and  should be removed or completely rewritten to align with the new drag-and-drop specification.

**key api endpoints**
*   **Obsolete Endpoints (To be replaced):**
    *   
    *   
    *   
    *   And 4 others related to the capital-allocation model.
*   **New Endpoints (To be implemented):**
    *   
    *   
    *   
    *   
    *   

**Critical Info for New Agent**
-   **COMPLETE REDESIGN:** Your primary task is to scrap the existing Investment Committee feature and build a new one from scratch based on the user's latest drag-and-drop specification. The previous modal-based implementation is **100% obsolete**.
-   **BLOCKING FIRST STEP:** You **MUST** add two new MT5 accounts (901351 and 901353) to the  collection before starting any other work. The user has provided a script/command for this. The UI will not display correctly without these accounts.
-   **ARCHITECTURE SHIFT:** The new system does not use the  collection. All logic is based on updating assignment fields (, , etc.) directly within the existing  collection documents.
-   **NEW SPECIFICATION IS LAW:** Adhere strictly to the document titled . It contains the complete layout, data models, API signatures, and component examples for the new feature.

**documents created in this job**
The agent processed several user messages that serve as specification documents, most notably:
-    (Specification for the first, now obsolete, version)
-    (Specification for the new, current task)
-    (Critical prerequisite instructions)

**Last 5 User Messages and any pending user messages**
1.  **User approved backend:** The user confirmed the backend for the first version of the tool was complete and approved it. (COMPLETED)
2.  **User requested frontend:** The user instructed the agent to proceed with building the frontend UI for the first version. (COMPLETED)
3.  **User provided new spec:** The user sent a new, extremely detailed specification for a complete redesign of the feature into a drag-and-drop interface, making the previous work obsolete. (PENDING IMPLEMENTATION)
4.  **User sent urgent prerequisite:** The user sent a follow-up message emphasizing that two new MT5 accounts (901351 and 901353) MUST be added to the database before any UI work on the new design begins. (PENDING IMPLEMENTATION)
5.  **Agent acknowledged redesign:** The agent confirmed understanding of the complete redesign and the prerequisite task of adding the new accounts. (AWAITING AGENT ACTION)

**Project Health Check:**
-   **Broken**: No part of the existing, stable application is broken.
-   **Mocked**: Referral Link Analytics on the agent profile page still use placeholder data.
-   **Obsolete**: The entire Investment Committee Tab feature (V1) is now obsolete and requires a full replacement.

**Testing status**
-   **Testing agent used after significant changes**: YES. The testing agent was used to validate the frontend of the (now obsolete) V1 Investment Committee tab, successfully identifying authentication and null-value bugs, which were then fixed.
-   **Troubleshoot agent used after agent stuck in loop**: NO
-   **Test files created**:
    -    (Tests the obsolete V1 backend)
-   **Known regressions**: None.

**Credentials to test flow:**
-   **Salvador Palma (Admin Agent):**
    -   Email: 
    -   Password: 

**What agent forgot to execute**
The agent has not forgotten to execute any tasks. It correctly identified the major pivot in requirements from the user and was about to execute the first step of the new plan before the handoff.</analysis>
